import{c as Ve,d as Ae,e as qe,f as Ue,g as We,h as He}from"./chunk-NU3SRIYC.js";import{a as De}from"./chunk-PMOG4S75.js";import{a as Re}from"./chunk-3ZIDYFSV.js";import"./chunk-XFEE3PRU.js";import{a as ze,b as R,c as Ne,d as V}from"./chunk-QHZRYLVR.js";import{a as Be,b as N}from"./chunk-X67Z44SH.js";import"./chunk-DOKGUGK4.js";import{q as Ie}from"./chunk-NN2UDVZC.js";import{$a as fe,A as ee,Aa as B,Ca as z,Ea as de,F as te,Fa as pe,Ga as ce,H as ne,Ha as se,Ia as ge,Ka as ue,ab as _e,bb as he,cb as Ce,db as Me,fb as be,gb as xe,ib as Oe,jb as Se,la as oe,lb as we,mb as Pe,oa as ie,ob as ye,pb as ke,r as Q,rb as ve,sa as ae,sb as Te,ub as Fe,va as re,vb as Ee,w as X,wa as le,x as Y,y as Z,yb as Le,z as $,za as me}from"./chunk-KWAI636N.js";import{Ab as h,Bb as x,Cb as O,Eb as I,Hb as C,Ic as K,Jb as S,Jc as D,Mb as W,Oc as J,Qc as T,Rb as E,Sb as l,Tb as w,Ub as _,Vb as P,Wa as a,Wb as y,Xb as k,Yb as H,Zb as v,bc as j,dc as G,f as M,fa as F,ka as b,nb as c,pb as p,rb as U,ta as g,ua as u,yb as o,zb as i}from"./chunk-UIILES4X.js";import{a as A,b as q,e as L}from"./chunk-DVOCWXDE.js";function Xe(t,r){if(t&1&&(o(0,"mat-option",17),l(1),i()),t&2){let e=r.$implicit;p("value",e.uid),a(),w(e.name)}}function Ye(t,r){if(t&1&&(o(0,"mat-option",17),l(1),i()),t&2){let e=r.$implicit;p("value",e.value),a(),w(e.label)}}function Ze(t,r){if(t&1&&(o(0,"mat-option",17),l(1),i()),t&2){let e=r.$implicit;p("value",e.value),a(),w(e.label)}}var Ke=(()=>{class t{constructor(){this.queries=new M,this.user=F(De),this.textButton="Filtrar",this.logBookFilter={},this.today=new Date,this.users=[],this.selectedUser=null,this.selectedaction=null,this.selectedModule=null,this.dateRange={start:null,end:null},this.dateRangeStart=null,this.dateRangeEnd=null,this.modules=[],this.actions=[]}ngOnInit(){return L(this,null,function*(){this.users=yield this.user.getAll(),Object.values(Ne).forEach(e=>{this.modules.push({value:e,label:V[e]})}),Object.values(ze).forEach(e=>{this.actions.push({value:e,label:R[e]})})})}onSubmit(e){let d={"user.uid":e.value.user?e.value.user??"":"",action:e.value.action??"",module:e.value.module??"",dateRangeStart:new Date(e.value.startDate).setHours(0,0,0,0).valueOf()??"",dateRangeEnd:new Date(e.value.endDate).setHours(23,59,59,999).valueOf()??""};this.queries.next(d)}limpiarFormulario(e){e.resetForm(),this.logBookFilter={}}static{this.\u0275fac=function(d){return new(d||t)}}static{this.\u0275cmp=b({type:t,selectors:[["app-logbook-form"]],inputs:{queries:"queries"},standalone:!0,features:[v],decls:37,vars:12,consts:[["logBookFilter","ngForm"],["picker",""],[1,"form-container"],[1,"form-card"],[1,"logBookFilter-form",3,"ngSubmit"],[3,"rangePicker"],["matStartDate","","placeholder","Start date","name","startDate","required","",3,"ngModelChange","ngModel"],["matEndDate","","placeholder","End date","name","endDate","required","",3,"ngModelChange","ngModel"],["matIconSuffix","",3,"for"],["appearance","outline",1,"full-width"],["name","user","required","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","action","required","",3,"ngModelChange","ngModel"],["name","module","required","",3,"ngModelChange","ngModel"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-outlined-button","","type","button",3,"click"],[3,"value"]],template:function(d,n){if(d&1){let s=I();o(0,"div",2)(1,"mat-card",3)(2,"mat-card-header")(3,"mat-card-title"),l(4,"Filtros"),i()(),o(5,"mat-card-content")(6,"form",4,0),C("ngSubmit",function(){g(s);let m=E(7);return u(n.onSubmit(m))}),o(8,"mat-form-field")(9,"mat-label"),l(10,"Enter a date range"),i(),o(11,"mat-date-range-input",5)(12,"input",6),k("ngModelChange",function(m){return g(s),y(n.dateRange.start,m)||(n.dateRange.start=m),u(m)}),i(),o(13,"input",7),k("ngModelChange",function(m){return g(s),y(n.dateRange.end,m)||(n.dateRange.end=m),u(m)}),i()(),h(14,"mat-datepicker-toggle",8)(15,"mat-date-range-picker",null,1),i(),o(17,"mat-form-field",9)(18,"mat-label"),l(19,"Usuario"),i(),o(20,"mat-select",10),k("ngModelChange",function(m){return g(s),y(n.selectedUser,m)||(n.selectedUser=m),u(m)}),c(21,Xe,2,2,"mat-option",11),i()(),o(22,"mat-form-field",9)(23,"mat-label"),l(24,"Tipo de Acci\xF3n"),i(),o(25,"mat-select",12),k("ngModelChange",function(m){return g(s),y(n.selectedaction,m)||(n.selectedaction=m),u(m)}),c(26,Ye,2,2,"mat-option",11),i()(),o(27,"mat-form-field",9)(28,"mat-label"),l(29,"M\xF3dulo"),i(),o(30,"mat-select",13),k("ngModelChange",function(m){return g(s),y(n.selectedModule,m)||(n.selectedModule=m),u(m)}),c(31,Ze,2,2,"mat-option",11),i()(),o(32,"div",14)(33,"button",15),l(34),i(),o(35,"button",16),C("click",function(){g(s);let m=E(7);return u(n.limpiarFormulario(m))}),l(36," Limpiar "),i()()()()()()}if(d&2){let s=E(7),f=E(16);a(11),p("rangePicker",f),a(),P("ngModel",n.dateRange.start),a(),P("ngModel",n.dateRange.end),a(),p("for",f),a(6),P("ngModel",n.selectedUser),a(),p("ngForOf",n.users),a(4),P("ngModel",n.selectedaction),a(),p("ngForOf",n.actions),a(4),P("ngModel",n.selectedModule),a(),p("ngForOf",n.modules),a(2),p("disabled",!s.valid),a(),_(" ",n.textButton," ")}},dependencies:[T,K,ne,ee,Q,X,Y,te,$,Z,He,Ve,Ue,Ae,qe,We,le,re,ie,ae,me,Te,ve,oe,z,B,ue,pe,se,ge,ce],styles:[".form-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;padding:24px;height:fit-content}.form-card[_ngcontent-%COMP%]{width:100%;max-width:420px;padding:32px 28px 24px;border-radius:16px;box-shadow:0 2px 16px #00000014}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:18px;text-align:center}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#222;margin:0}.logBookFilter-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:18px}.logBookFilter-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:0}.logBookFilter-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{border-radius:6px}.button-group[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center;margin-top:18px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:110px;height:40px;border-radius:6px;font-weight:500;font-size:15px}.button-group[_ngcontent-%COMP%]   button[color=primary][_ngcontent-%COMP%]:disabled{background:#ccc;color:#999}mat-date-range-input[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]{width:100%}@media (max-width: 768px){.form-container[_ngcontent-%COMP%]{padding:8px}.form-card[_ngcontent-%COMP%]{padding:12px;max-width:100%}.button-group[_ngcontent-%COMP%]{flex-direction:column}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}@media (min-width: 1025px){.form-container[_ngcontent-%COMP%]{padding:0;height:auto}.form-card[_ngcontent-%COMP%]{max-width:420px}}"]})}}return t})();function $e(t,r){t&1&&(o(0,"div",3)(1,"p"),l(2,"Cargando parametrizaciones de alerta..."),i()())}function et(t,r){t&1&&(o(0,"th",14),l(1," Fecha Hora "),i())}function tt(t,r){if(t&1&&(o(0,"td",15),l(1),j(2,"date"),i()),t&2){let e=r.$implicit;a(),_(" ",G(2,1,e.date,"short")," ")}}function nt(t,r){t&1&&(o(0,"th",14),l(1," Usuario "),i())}function ot(t,r){if(t&1&&(o(0,"td",15),l(1),i()),t&2){let e=r.$implicit;a(),_(" ",e.userName," ")}}function it(t,r){t&1&&(o(0,"th",14),l(1," Descripci\xF3n "),i())}function at(t,r){if(t&1&&(o(0,"td",15)(1,"span",16),l(2),i()()),t&2){let e=r.$implicit;a(),W("matTooltip",e.description||"N/A"),a(),w(e.description||"N/A")}}function rt(t,r){t&1&&(o(0,"th",14),l(1," Acci\xF3n "),i())}function lt(t,r){if(t&1&&(o(0,"td",15),l(1),i()),t&2){let e=r.$implicit;a(),_(" ",e.action||"N/A"," ")}}function mt(t,r){t&1&&(o(0,"th",14),l(1," M\xF3dulo "),i())}function dt(t,r){if(t&1&&(o(0,"td",15),l(1),i()),t&2){let e=r.$implicit;a(),_(" ",e.module||"N/A"," ")}}function pt(t,r){t&1&&h(0,"tr",17)}function ct(t,r){t&1&&h(0,"tr",18)}function st(t,r){if(t&1&&(o(0,"table",4),x(1,5),c(2,et,2,0,"th",6)(3,tt,3,4,"td",7),O(),x(4,8),c(5,nt,2,0,"th",6)(6,ot,2,1,"td",7),O(),x(7,9),c(8,it,2,0,"th",6)(9,at,3,2,"td",7),O(),x(10,10),c(11,rt,2,0,"th",6)(12,lt,2,1,"td",7),O(),x(13,11),c(14,mt,2,0,"th",6)(15,dt,2,1,"td",7),O(),c(16,pt,1,0,"tr",12)(17,ct,1,0,"tr",13),i()),t&2){let e=S();p("dataSource",e.dataSource),a(16),p("matHeaderRowDef",e.displayedColumns),a(),p("matRowDefColumns",e.displayedColumns)}}function gt(t,r){if(t&1){let e=I();o(0,"mat-paginator",19),C("page",function(n){g(e);let s=S();return u(s.onPageChange(n))}),i()}if(t&2){let e=S();p("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.pageIndex>0?e.pageIndex-1:0)("pageSizeOptions",e.pageSizeOptions)}}var Je=(()=>{class t{constructor(){this.queries=new M,this.logBookUseCase=F(N),this.notification=F(Le),this.actions=R,this.modules=V,this.loading=!1,this.totalItems=0,this.pageSize=10,this.pageIndex=1,this.pageSizeOptions=[5,10,20],this.dataSource=[],this.displayedColumns=["date","userName","action","module","description"]}ngOnInit(){this.getDataSource(),this.queries.subscribe(e=>{this.getDataSource(e)})}getDataSource(e){return L(this,null,function*(){this.loading=!0;try{let d=yield this.logBookUseCase.listLogBooksByPagination(this.pageSize,this.pageIndex,e);this.totalItems=yield this.logBookUseCase.getTotalLogBooks(e),e&&Object.keys(e).length>0?(this.pageSize=this.totalItems,this.pageIndex=1,this.pageSizeOptions=[this.totalItems]):(this.pageSizeOptions=[5,10,20],this.pageSize=10),this.dataSource=d.map(n=>q(A({},n),{action:this.actions[n.action]||"N/A",module:this.modules[n.module]||"N/A",userName:n.user?`${n.user.name}`:"N/A"}))}catch(d){console.error("Error fetching log books:",d),this.notification.error(d?.message||"Error al cargar los libros de registro")}finally{this.loading=!1}})}editAlert(e){}onPageChange(e){this.pageIndex=e.pageIndex===0?1:e.pageIndex+1,this.pageSize=e.pageSize,this.getDataSource()}static{this.\u0275fac=function(d){return new(d||t)}}static{this.\u0275cmp=b({type:t,selectors:[["app-logbook-table"]],inputs:{queries:"queries"},standalone:!0,features:[v],decls:4,vars:3,consts:[["class","loading-container",4,"ngIf"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf"],["showFirstLastButtons","","aria-label","Seleccionar p\xE1gina de bitacora",3,"length","pageSize","pageIndex","pageSizeOptions","page",4,"ngIf"],[1,"loading-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","userName"],["matColumnDef","description"],["matColumnDef","action"],["matColumnDef","module"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"matTooltip"],["mat-header-row",""],["mat-row",""],["showFirstLastButtons","","aria-label","Seleccionar p\xE1gina de bitacora",3,"page","length","pageSize","pageIndex","pageSizeOptions"]],template:function(d,n){d&1&&(o(0,"div"),c(1,$e,3,0,"div",0)(2,st,18,3,"table",1)(3,gt,1,4,"mat-paginator",2),i()),d&2&&(a(),p("ngIf",n.loading),a(),p("ngIf",!n.loading),a(),p("ngIf",!n.loading))},dependencies:[ke,he,Me,Se,be,Ce,we,xe,Oe,Pe,ye,Ee,Fe,z,T,D,J,de,_e,fe],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{padding:20px;height:100%;display:flex;flex-direction:column;max-width:800px;margin:0 auto}.mat-elevation-z8[_ngcontent-%COMP%]{border-radius:8px 8px 0 0!important;box-shadow:0 2px 8px #0000001a}table[_ngcontent-%COMP%]{width:100%;overflow:hidden;flex:1}.table-row[_ngcontent-%COMP%]{height:20px!important}.mat-mdc-header-row[_ngcontent-%COMP%]{height:40px!important}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:4px 12px!important;font-size:14px;line-height:1.2}mat-paginator[_ngcontent-%COMP%]{border-radius:0 0 8px 8px!important;margin-top:0;box-shadow:0 2px 8px #0000001a}.actions-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 3px;width:90px!important;height:30px;font-size:15px;font-weight:500;border-radius:4px;line-height:1;padding:0 6px}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]{background-color:#ff9800;color:#fff}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]:hover{background-color:#f57c00}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]:hover{background-color:#d32f2f}.loading-container[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#666;font-style:italic}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]{padding:16px}table[_ngcontent-%COMP%]{font-size:14px}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:3px 6px!important}.table-row[_ngcontent-%COMP%]{height:28px!important}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:45px;height:20px;margin:0 1px;font-size:10px;padding:0 4px}}@media (min-width: 1025px){.table-container[_ngcontent-%COMP%]{padding:0;height:calc(100vh - 40px);max-width:100%;margin:0}}']})}}return t})();function ut(t,r){if(t&1&&(o(0,"div",7)(1,"div",7),h(2,"app-logbook-form",6),i()()),t&2){let e=S();a(2),p("queries",e.queries)}}var sn=(()=>{class t{constructor(){this.queries=new M,this.showForm=!1,this.isMobile=!1}ngOnInit(){}toggleForm(){this.showForm=!this.showForm}static{this.\u0275fac=function(d){return new(d||t)}}static{this.\u0275cmp=b({type:t,selectors:[["app-page"]],standalone:!0,features:[H([{provide:Be,useClass:Re},N]),v],decls:8,vars:5,consts:[[1,"alert-layout"],[1,"toolbar"],["mat-raised-button","","color","primary",3,"click"],[1,"layout"],["class","form-section",4,"ngIf"],[1,"table-section"],[3,"queries"],[1,"form-section"]],template:function(d,n){d&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),C("click",function(){return n.toggleForm()}),l(3),i()(),o(4,"div",3),c(5,ut,3,1,"div",4),o(6,"div",5),h(7,"app-logbook-table",6),i()()()),d&2&&(a(3),_(" ",n.showForm?"Ocultar formulario":"Filtros"," "),a(),U("column",n.isMobile),a(),p("ngIf",n.showForm),a(2),p("queries",n.queries))},dependencies:[Je,Ke,T,D,Ie,B],styles:[".layout[_ngcontent-%COMP%]{display:flex;gap:24px;padding:20px;box-sizing:border-box}.layout.column[_ngcontent-%COMP%]{flex-direction:column}.layout.column[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%], .layout.column[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{width:100%;flex:none}.form-section[_ngcontent-%COMP%]{flex:0 0 350px;min-width:0}.table-section[_ngcontent-%COMP%]{flex:1;min-width:0}.toolbar[_ngcontent-%COMP%]{padding:16px 20px 0}"]})}}return t})();export{sn as LogBookPageComponent};
