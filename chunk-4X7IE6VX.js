import{a as Yt}from"./chunk-UBNZHO2Z.js";import{a as Lt,b as S}from"./chunk-WA5C6RWQ.js";import{a as $t}from"./chunk-A5LTIFC2.js";import{a as Ht}from"./chunk-RWWEWMPT.js";import"./chunk-FMBXTAWF.js";import{a as E,c as F}from"./chunk-DZLUVXQM.js";import{a as T,b as Ut}from"./chunk-2NXNVONS.js";import{b as Y}from"./chunk-2BKWH26S.js";import"./chunk-WRDK3TEQ.js";import{$ as dt,$a as Ft,A as it,B as at,E as ot,F as rt,H as mt,Ra as xt,Sa as Ot,Ta as vt,Va as wt,Wa as Tt,Ya as St,Za as Et,_ as lt,aa as st,ab as Dt,cb as It,db as zt,fb as At,gb as Bt,ha as ct,ia as pt,ib as Nt,ka as ut,kb as kt,la as ft,ma as $,na as gt,oa as H,pa as ht,qa as _t,qb as w,r as Q,ra as bt,rb as Vt,sa as Ct,sb as Rt,ta as yt,ua as Pt,w as X,wa as Mt,x as tt,y as et,z as nt}from"./chunk-ANDZIBJU.js";import{Ab as M,Bb as _,Cb as b,Eb as A,Hb as P,Jb as O,Kc as U,Oc as J,Qc as L,Rb as B,Sb as r,Ub as u,Vb as N,Wa as l,Wb as k,Xa as z,Xb as V,Yb as Z,Zb as v,cc as W,ec as j,f as I,fa as f,ka as x,nb as p,pb as c,rb as K,rc as R,t as G,ta as g,ua as h,yb as n,zb as i}from"./chunk-75LTUFHW.js";import{a as D,b as q,e as y}from"./chunk-DVOCWXDE.js";var qt=(()=>{class t{constructor(e){this.cdr=e,this.paymentObservable=null,this.updateTable=null,this.user=f(Y),this.paymentUseCases=f(S),this.logBook=f(T),this.notification=f(w),this.textButton="Crear Pago",this.payment={},this.isEditing=!1,this.loading=!1}ngOnInit(){this.paymentObservable&&(this.subscription=this.paymentObservable.subscribe(e=>{e&&e.uid!==void 0&&(this.textButton="Editar Pago",this.isEditing=!0),this.payment=D({},e),this.cdr.detectChanges()}))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}onSubmit(e){return y(this,null,function*(){if(!e.valid){this.notification.error("Por favor, complete todos los campos requeridos");return}let d=this.user.getUser();if(!d){this.notification.error("Usuario no autenticado");return}this.loading=!0;let a=D({},e.value),o=q(D({},this.payment),{amount:a.amount,combined:a.combined,digits:a.digits});try{if(o.digits<=2&&o.combined){this.notification.error("Los d\xEDgitos deben ser mayores a 2 si la opci\xF3n combinada est\xE1 activada"),this.loading=!1;return}if((yield this.paymentUseCases.getPaymentParameterizationByValue(o.amount,o.digits,o.combined))&&!this.isEditing){this.notification.error("Ya existe una parametrizaci\xF3n de pago con este valor y d\xEDgitos"),this.loading=!1;return}this.isEditing?(o.updatedBy=d,o.updatedAt=Date.now(),yield this.paymentUseCases.updatePaymentParameterization(o.uid,o).then(s=>y(this,null,function*(){yield this.logBook.createLogBook({action:E.UPDATE,user:this.user.getUser(),date:Date.now().valueOf(),module:F.PAYMENT,description:`Se actualiz\xF3 la parametrizaci\xF3n de pago con id ${s.uid} y digitos ${o.digits} y valor de ${this.payment.amount} a ${s.amount}`})}))):(o.uid=`payment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o.createdBy=d,o.createdAt=Date.now(),yield this.paymentUseCases.createPaymentParameterization(o).then(s=>y(this,null,function*(){yield this.logBook.createLogBook({action:E.CREATE,user:this.user.getUser(),date:Date.now().valueOf(),module:F.PAYMENT,description:`Se cre\xF3 una nueva parametrizaci\xF3n de pago con d\xEDgitos ${s.digits} y valor ${s.amount}`})}))),this.notification.success(`Parametrizaci\xF3n de pago ${this.isEditing?"actualizada":"creada"} exitosamente`),this.limpiarFormulario(e),this.loading=!1,this.updateTable?.next(!0)}catch(C){console.error("Error saving payment parameterization:",C),this.notification.error(C?.message||"Error al guardar la parametrizaci\xF3n de pago")}finally{this.loading=!1}})}limpiarFormulario(e){e.resetForm(),this.textButton="Crear Pago",this.isEditing=!1,this.payment={},this.cdr.detectChanges()}static{this.\u0275fac=function(d){return new(d||t)(z(R))}}static{this.\u0275cmp=x({type:t,selectors:[["app-payment-form"]],inputs:{paymentObservable:"paymentObservable",updateTable:"updateTable"},standalone:!0,features:[v],decls:29,vars:8,consts:[["paymentForm","ngForm"],[1,"form-container"],[1,"form-card"],[1,"payment-form",3,"ngSubmit"],["appearance","outline",1,"full-width"],["matInput","","type","number","name","digits","required","","min","1","placeholder","Ingrese los digitos",3,"ngModelChange","ngModel"],["matInput","","type","number","name","amount","required","","min","0","placeholder","Ingrese el multiplicador",3,"ngModelChange","ngModel"],["name","combined","required","",3,"ngModelChange","ngModel"],[3,"value"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-outlined-button","","type","button",3,"click","disabled"]],template:function(d,a){if(d&1){let o=A();n(0,"div",1)(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Configuraci\xF3n de Pago"),i()(),n(5,"mat-card-content")(6,"form",3,0),P("ngSubmit",function(){g(o);let s=B(7);return h(a.onSubmit(s))}),n(8,"mat-form-field",4)(9,"mat-label"),r(10,"Digitos"),i(),n(11,"input",5),V("ngModelChange",function(s){return g(o),k(a.payment.digits,s)||(a.payment.digits=s),h(s)}),i()(),n(12,"mat-form-field",4)(13,"mat-label"),r(14,"Multiplicador de pago"),i(),n(15,"input",6),V("ngModelChange",function(s){return g(o),k(a.payment.amount,s)||(a.payment.amount=s),h(s)}),i()(),n(16,"mat-form-field",4)(17,"mat-label"),r(18,"Combinado"),i(),n(19,"mat-select",7),V("ngModelChange",function(s){return g(o),k(a.payment.combined,s)||(a.payment.combined=s),h(s)}),n(20,"mat-option",8),r(21,"S\xED"),i(),n(22,"mat-option",8),r(23,"No"),i()()(),n(24,"div",9)(25,"button",10),r(26),i(),n(27,"button",11),P("click",function(){g(o);let s=B(7);return h(a.limpiarFormulario(s))}),r(28," Limpiar "),i()()()()()()}if(d&2){let o=B(7);l(11),N("ngModel",a.payment.digits),l(4),N("ngModel",a.payment.amount),l(4),N("ngModel",a.payment.combined),l(),c("value",!0),l(2),c("value",!1),l(3),c("disabled",!o.valid||a.loading),l(),u(" ",a.loading?"Guardando...":a.textButton," "),l(),c("disabled",a.loading)}},dependencies:[mt,it,Q,at,X,tt,rt,ot,nt,et,pt,ct,st,ft,ut,Bt,At,lt,dt,H,$,Mt,bt,yt,Pt,Ct],styles:[".form-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;padding:15px;height:fit-content}.form-card[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:16px;border-radius:8px;box-shadow:0 2px 8px #0000001a}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:12px;text-align:center}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;color:#333;margin:0}.payment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.payment-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.payment-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{border-radius:4px}.button-group[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:center;margin-top:12px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:90px;height:36px;border-radius:4px;font-weight:500;font-size:14px}.button-group[_ngcontent-%COMP%]   button[color=primary][_ngcontent-%COMP%]:disabled{background:#ccc;color:#999}@media (max-width: 768px){.form-container[_ngcontent-%COMP%], .form-card[_ngcontent-%COMP%]{padding:12px}.button-group[_ngcontent-%COMP%]{flex-direction:column}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}@media (min-width: 1025px){.form-container[_ngcontent-%COMP%]{padding:0;height:auto}.form-card[_ngcontent-%COMP%]{max-width:350px}}"]})}}return t})();function Zt(t,m){t&1&&(n(0,"div",2)(1,"p"),r(2,"Cargando parametrizaciones de pago..."),i()())}function Jt(t,m){t&1&&(n(0,"th",17),r(1," Digitos "),i())}function Qt(t,m){if(t&1&&(n(0,"td",18),r(1),i()),t&2){let e=m.$implicit;l(),u(" ",e.digits," ")}}function Xt(t,m){t&1&&(n(0,"th",17),r(1," Multiplicador de pago "),i())}function te(t,m){if(t&1&&(n(0,"td",18),r(1),i()),t&2){let e=m.$implicit;l(),u(" $",e.amount," ")}}function ee(t,m){t&1&&(n(0,"th",17),r(1," Combinado? "),i())}function ne(t,m){if(t&1&&(n(0,"td",18),r(1),i()),t&2){let e=m.$implicit;l(),u(" ",e.combined?"SI":"NO"," ")}}function ie(t,m){t&1&&(n(0,"th",17),r(1," Creado por "),i())}function ae(t,m){if(t&1&&(n(0,"td",18),r(1),i()),t&2){let e=m.$implicit;l(),u(" ",(e.createdBy==null?null:e.createdBy.name)||"N/A"," ")}}function oe(t,m){t&1&&(n(0,"th",17),r(1," Fecha de creaci\xF3n "),i())}function re(t,m){if(t&1&&(n(0,"td",18),r(1),W(2,"date"),i()),t&2){let e=m.$implicit;l(),u(" ",e.createdAt?j(2,1,e.createdAt,"dd-MM-YYYY hh:mm:ss"):"N/A"," ")}}function me(t,m){t&1&&(n(0,"th",17),r(1," Actualizado por "),i())}function le(t,m){if(t&1&&(n(0,"td",18),r(1),i()),t&2){let e=m.$implicit;l(),u(" ",(e.updatedBy==null?null:e.updatedBy.name)||"N/A"," ")}}function de(t,m){t&1&&(n(0,"th",17),r(1," \xDAltima actualizaci\xF3n "),i())}function se(t,m){if(t&1&&(n(0,"td",18),r(1),W(2,"date"),i()),t&2){let e=m.$implicit;l(),u(" ",e.updatedAt?j(2,1,e.updatedAt,"dd-MM-YYYY hh:mm:ss"):"N/A"," ")}}function ce(t,m){t&1&&(n(0,"th",19),r(1," Acciones "),i())}function pe(t,m){if(t&1){let e=A();n(0,"td",18)(1,"button",20),P("click",function(){let a=g(e).$implicit,o=O(2);return h(o.editPayment(a))}),n(2,"mat-icon"),r(3,"edit"),i()(),n(4,"button",21),P("click",function(){let a=g(e).$implicit,o=O(2);return h(o.deletePayment(a))}),n(5,"mat-icon"),r(6,"delete"),i()()()}}function ue(t,m){t&1&&M(0,"tr",22)}function fe(t,m){t&1&&M(0,"tr",23)}function ge(t,m){if(t&1&&(n(0,"table",3),_(1,4),p(2,Jt,2,0,"th",5)(3,Qt,2,1,"td",6),b(),_(4,7),p(5,Xt,2,0,"th",5)(6,te,2,1,"td",6),b(),_(7,8),p(8,ee,2,0,"th",5)(9,ne,2,1,"td",6),b(),_(10,9),p(11,ie,2,0,"th",5)(12,ae,2,1,"td",6),b(),_(13,10),p(14,oe,2,0,"th",5)(15,re,3,4,"td",6),b(),_(16,11),p(17,me,2,0,"th",5)(18,le,2,1,"td",6),b(),_(19,12),p(20,de,2,0,"th",5)(21,se,3,4,"td",6),b(),_(22,13),p(23,ce,2,0,"th",14)(24,pe,7,0,"td",6),b(),p(25,ue,1,0,"tr",15)(26,fe,1,0,"tr",16),i()),t&2){let e=O();c("dataSource",e.dataSource),l(25),c("matHeaderRowDef",e.displayedColumns),l(),c("matRowDefColumns",e.displayedColumns)}}var Gt=(()=>{class t{constructor(e){this.cdr=e,this.paymentObservable=null,this.updateTable=null,this.showFormObservable=null,this.paymentParameterizationUseCase=f(S),this.user=f(Y),this.logBook=f(T),this.notification=f(w),this.dialog=f(kt),this.loading=!1,this.dataSource=[],this.displayedColumns=["digits","amount","combined","createdBy","createdAt","updatedBy","updatedAt","actions"]}ngOnInit(){this.getDataSource(),this.updateTable&&(this.updateSubscription=this.updateTable.subscribe(e=>{this.getDataSource()}))}ngOnDestroy(){this.updateSubscription&&this.updateSubscription.unsubscribe()}getDataSource(){return y(this,null,function*(){this.loading=!0;try{let e=yield this.paymentParameterizationUseCase.listPaymentParameterizations();this.dataSource=e}catch(e){console.error("Error fetching payment parameterizations:",e),this.notification.error(e?.message||"Error al cargar las parametrizaciones de pago")}finally{this.loading=!1}})}editPayment(e){document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.showFormObservable?.next(!0),setTimeout(()=>{this.paymentObservable?.next(e)},100)}deletePayment(e){return y(this,null,function*(){document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur();let d=this.dialog.open(Ht,{data:{title:"Eliminar parametrizaci\xF3n de pago",message:"\xBFEst\xE1 seguro que desea eliminar esta parametrizaci\xF3n de pago?"}});if(yield G(d.afterClosed()))try{yield this.paymentParameterizationUseCase.deletePaymentParameterization(e.uid).then(()=>y(this,null,function*(){yield this.logBook.createLogBook({action:E.DELETE,user:this.user.getUser(),date:Date.now().valueOf(),module:F.PAYMENT,description:`Se elimin\xF3 la parametrizaci\xF3n de alerta con id ${e.uid}`})})),this.notification.success("Parametrizaci\xF3n de pago eliminada exitosamente"),yield this.getDataSource()}catch(o){console.error("Error deleting payment parameterization:",o),this.notification.error(o?.message||"Error al eliminar la parametrizaci\xF3n de pago")}})}static{this.\u0275fac=function(d){return new(d||t)(z(R))}}static{this.\u0275cmp=x({type:t,selectors:[["app-payment-table"]],inputs:{paymentObservable:"paymentObservable",updateTable:"updateTable",showFormObservable:"showFormObservable"},standalone:!0,features:[v],decls:3,vars:2,consts:[["class","loading-container",4,"ngIf"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf"],[1,"loading-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","digits"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["matColumnDef","combined"],["matColumnDef","createdBy"],["matColumnDef","createdAt"],["matColumnDef","updatedBy"],["matColumnDef","updatedAt"],["matColumnDef","actions"],["mat-header-cell","","class","actions-header",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"actions-header"],["mat-icon-button","","color","primary","title","Editar",3,"click"],["mat-icon-button","","color","warn","title","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(d,a){d&1&&(n(0,"div"),p(1,Zt,3,0,"div",0)(2,ge,27,3,"table",1),i()),d&2&&(l(),c("ngIf",a.loading),l(),c("ngIf",!a.loading))},dependencies:[zt,xt,vt,Et,wt,Ot,Ft,Tt,St,Dt,It,Nt,H,gt,J,L,U,_t,ht],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{padding:20px;height:100%;display:flex;flex-direction:column;max-width:800px;margin:0 auto}.mat-elevation-z8[_ngcontent-%COMP%]{border-radius:8px 8px 0 0!important;box-shadow:0 2px 8px #0000001a}table[_ngcontent-%COMP%]{width:100%;overflow:hidden;flex:1}.table-row[_ngcontent-%COMP%]{height:20px!important}.mat-mdc-header-row[_ngcontent-%COMP%]{height:40px!important}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:4px 12px!important;font-size:14px;line-height:1.2}mat-paginator[_ngcontent-%COMP%]{border-radius:0 0 8px 8px!important;margin-top:0;box-shadow:0 2px 8px #0000001a}.actions-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 3px;width:90px!important;height:30px;font-size:15px;font-weight:500;border-radius:4px;line-height:1;padding:0 6px}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]{background-color:#ff9800;color:#fff}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]:hover{background-color:#f57c00}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]:hover{background-color:#d32f2f}.loading-container[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#666;font-style:italic}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]{padding:16px}table[_ngcontent-%COMP%]{font-size:14px}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:3px 6px!important}.table-row[_ngcontent-%COMP%]{height:28px!important}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:45px;height:20px;margin:0 1px;font-size:10px;padding:0 4px}}@media (min-width: 1025px){.table-container[_ngcontent-%COMP%]{padding:0;height:calc(100vh - 40px);max-width:100%;margin:0}}']})}}return t})();function he(t,m){if(t&1&&(n(0,"div",8)(1,"div",8),M(2,"app-payment-form",9),i()()),t&2){let e=O();l(2),c("paymentObservable",e.paymentObservable)("updateTable",e.updateTable)}}var Mn=(()=>{class t{constructor(){this.paymentObservable=new I,this.updateTable=new I,this.showFormObservable=new I,this.showForm=!1,this.isMobile=!1}toggleForm(){this.showForm=!this.showForm}ngOnInit(){this.showFormObservable.next(!1),this.showFormObservable.subscribe(e=>{this.showForm=e})}ngOnDestroy(){this.paymentObservable.complete(),this.updateTable.complete(),this.showFormObservable.complete()}static{this.\u0275fac=function(d){return new(d||t)}}static{this.\u0275cmp=x({type:t,selectors:[["app-payment-parameterization-page"]],standalone:!0,features:[Z([{provide:Lt,useClass:Yt},{provide:w,useClass:Vt},{provide:T,useClass:$t},Ut,S]),v],decls:11,vars:7,consts:[[1,"alert-layout"],[1,"toolbar"],["mat-raised-button","","color","primary",3,"click"],[1,"layout"],["class","form-section",4,"ngIf"],[1,"table-section"],[3,"paymentObservable","updateTable","showFormObservable"],[1,"payment-layout"],[1,"form-section"],[3,"paymentObservable","updateTable"]],template:function(d,a){d&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),P("click",function(){return a.toggleForm()}),r(3),i()(),n(4,"div",3),p(5,he,3,2,"div",4),n(6,"div",5),M(7,"app-payment-table",6),i()()(),n(8,"div",7),M(9,"div",8)(10,"div",5),i()),d&2&&(l(3),u(" ",a.showForm?"Ocultar formulario":"Crear Pago"," "),l(),K("column",a.isMobile),l(),c("ngIf",a.showForm),l(2),c("paymentObservable",a.paymentObservable)("updateTable",a.updateTable)("showFormObservable",a.showFormObservable))},dependencies:[qt,Gt,L,U,Rt,$],styles:[".layout[_ngcontent-%COMP%]{display:flex;gap:24px;padding:20px;min-height:100vh;box-sizing:border-box}.layout.column[_ngcontent-%COMP%]{flex-direction:column}.layout.column[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%], .layout.column[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{width:100%;flex:none}.form-section[_ngcontent-%COMP%]{flex:0 0 350px;min-width:0}.table-section[_ngcontent-%COMP%]{flex:1;min-width:0}.toolbar[_ngcontent-%COMP%]{padding:16px 20px 0}"]})}}return t})();export{Mn as PaymentParameterizationPageComponent};
