import"./chunk-VEZLBGP7.js";import{b as He}from"./chunk-5IGTA6IO.js";import{a as A}from"./chunk-RVH4HJSJ.js";import{A as ie,F as oe,H as ae,Sa as xe,Ta as be,Ua as Me,Wa as Se,Xa as we,Za as Pe,_ as re,_a as ve,aa as le,ab as Oe,bb as ke,db as Te,eb as Ie,gb as Ne,ha as me,hb as De,ia as ce,ib as Fe,jb as Ee,ka as se,la as de,ma as q,oa as pe,pa as ue,qa as ge,r as Y,ra as fe,sa as he,sb as B,ta as _e,ua as Ce,ub as j,w as Z,wa as ye,x as ee,y as te,z as ne}from"./chunk-DMRUWG6L.js";import{Ab as k,Bb as M,Ca as J,Cb as S,Eb as w,Hb as _,Ic as K,Jb as u,Jc as V,Pc as X,Qc as v,Rb as C,Sb as c,Tb as $,Ub as h,Vb as D,Wa as l,Wb as F,Xa as I,Xb as E,Zb as P,_b as H,bc as z,cc as R,f as x,fa as O,gc as L,ka as b,nb as p,pb as s,qb as Q,qc as W,rb as N,ta as g,ua as f,yb as a,zb as r}from"./chunk-UIILES4X.js";import{e as T}from"./chunk-DVOCWXDE.js";function Be(t,m){if(t&1&&(a(0,"mat-option",14)(1,"span"),c(2),r()()),t&2){let e=m.$implicit;s("value",e._id),l(),Q("color",e.color),l(),$(e.name)}}var We=(()=>{class t{constructor(e){this.ChangeDetectorRef=e,this.searchResults=new J,this.queries=new x,this.notification=O(B),this.checkData={date:new Date(Date.now()-new Date().getTimezoneOffset()*6e4).toISOString().split("T")[0],lottery:"",lotteryNumber:""},this.loading=!1,this.lotteries=A}ngOnInit(){this.checkData.lottery=A[0]._id,this.ChangeDetectorRef.detectChanges()}onSubmit(e){if(!e.valid){this.notification.error("Por favor, complete todos los campos requeridos");return}if(e.valid){let i=[{date:e.value.date},{"lottery.id":e.value.lottery},{lotteryNumber:e.value.lotteryNumber}];this.queries.next(i)}}limpiarFormulario(e){e.resetForm(),this.checkData={date:"",lottery:"",lotteryNumber:""},this.queries.next([])}static{this.\u0275fac=function(i){return new(i||t)(I(W))}}static{this.\u0275cmp=b({type:t,selectors:[["app-check-hits-form"]],inputs:{queries:"queries"},outputs:{searchResults:"searchResults"},standalone:!0,features:[P],decls:27,vars:7,consts:[["checkForm","ngForm"],["lotterySelect",""],[1,"form-container"],[1,"form-card"],[1,"check-form",3,"ngSubmit"],["appearance","outline",1,"full-width"],["matInput","","type","date","name","date","required","",3,"ngModelChange","ngModel"],["appearance","outline"],["name","lottery","required","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","name","lotteryNumber","required","","placeholder","Ingrese el n\xFAmero apostado",3,"ngModelChange","ngModel"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-outlined-button","","type","button",3,"click","disabled"],[3,"value"]],template:function(i,n){if(i&1){let d=w();a(0,"div",2)(1,"mat-card",3)(2,"mat-card-header")(3,"mat-card-title"),c(4,"Consultar Aciertos"),r()(),a(5,"mat-card-content")(6,"form",4,0),_("ngSubmit",function(){g(d);let o=C(7);return f(n.onSubmit(o))}),a(8,"mat-form-field",5)(9,"mat-label"),c(10,"Fecha"),r(),a(11,"input",6),E("ngModelChange",function(o){return g(d),F(n.checkData.date,o)||(n.checkData.date=o),f(o)}),r()(),a(12,"mat-form-field",7)(13,"mat-label"),c(14,"Loter\xEDa"),r(),a(15,"mat-select",8,1),E("ngModelChange",function(o){return g(d),F(n.checkData.lottery,o)||(n.checkData.lottery=o),f(o)}),p(17,Be,3,4,"mat-option",9),r()(),a(18,"mat-form-field",5)(19,"mat-label"),c(20,"N\xFAmero apostado"),r(),a(21,"input",10),E("ngModelChange",function(o){return g(d),F(n.checkData.lotteryNumber,o)||(n.checkData.lotteryNumber=o),f(o)}),r()(),a(22,"div",11)(23,"button",12),c(24),r(),a(25,"button",13),_("click",function(){g(d);let o=C(7);return f(n.limpiarFormulario(o))}),c(26," Limpiar "),r()()()()()()}if(i&2){let d=C(7);l(11),D("ngModel",n.checkData.date),l(4),D("ngModel",n.checkData.lottery),l(2),s("ngForOf",n.lotteries),l(4),D("ngModel",n.checkData.lotteryNumber),l(2),s("disabled",!d.valid||n.loading),l(),h(" ",n.loading?"Consultando...":"Consultar"," "),l(),s("disabled",n.loading)}},dependencies:[ye,fe,_e,Ce,he,ce,me,le,de,se,De,Ne,re,pe,q,ae,ie,Y,Z,ee,oe,ne,te,v,K,j],styles:[".form-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;padding:15px;height:fit-content}.form-card[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:16px;border-radius:8px;box-shadow:0 2px 8px #0000001a}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:12px;text-align:center}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;color:#333;margin:0}.check-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.check-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.check-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{border-radius:4px}.button-group[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:center;margin-top:12px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:90px;height:36px;border-radius:4px;font-weight:500;font-size:14px}.button-group[_ngcontent-%COMP%]   button[color=primary][_ngcontent-%COMP%]:disabled{background:#ccc;color:#999}@media (max-width: 768px){.form-container[_ngcontent-%COMP%]{padding:12px}.form-card[_ngcontent-%COMP%]{max-width:100%;padding:12px}.button-group[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}@media (min-width: 1025px){.form-container[_ngcontent-%COMP%]{padding:0;height:auto}.form-card[_ngcontent-%COMP%]{max-width:350px}}"]})}}return t})();var U=()=>[void 0,null,""];function je(t,m){t&1&&(a(0,"div",8)(1,"p"),c(2,"Consultando aciertos..."),r()())}function Le(t,m){t&1&&(a(0,"th",20),c(1," N\xFAmero "),r())}function Ae(t,m){if(t&1&&(a(0,"td",21),c(1),r()),t&2){let e=m.$implicit;l(),h(" ",e.lotteryNumber," ")}}function Ue(t,m){t&1&&(a(0,"th",20),c(1," Vendedor "),r())}function Ge(t,m){if(t&1&&(a(0,"td",21),c(1),r()),t&2){let e=m.$implicit;l(),h(" ",e.seller.name," ")}}function Je(t,m){t&1&&(a(0,"th",20),c(1," Combinado "),r())}function Qe(t,m){t&1&&(a(0,"span",23)(1,"mat-icon"),c(2,"sync"),r()())}function $e(t,m){t&1&&(a(0,"span",24)(1,"mat-icon"),c(2,"sync_disabled"),r()())}function Ke(t,m){if(t&1&&(a(0,"td",21),p(1,Qe,3,0,"span",22)(2,$e,3,0,"ng-template",null,0,L),r()),t&2){let e=m.$implicit,i=C(3);l(),s("ngIf",e.combined)("ngIfElse",i)}}function Xe(t,m){t&1&&(a(0,"th",20),c(1," Valor "),r())}function Ye(t,m){if(t&1&&(a(0,"td",21),c(1),z(2,"currency"),r()),t&2){let e=m.$implicit;l(),h(" ",R(2,1,e.value)," ")}}function Ze(t,m){t&1&&(a(0,"th",20),c(1," Premio "),r())}function et(t,m){if(t&1&&(a(0,"span",26)(1,"mat-icon"),c(2,"notification_important"),r(),c(3),z(4,"currency"),r()),t&2){let e=u().$implicit,i=u(2);l(3),h(" ",R(4,1,i.calculatePrize(e).value)," ")}}function tt(t,m){t&1&&(a(0,"span",27),c(1,"Sin premio"),r())}function nt(t,m){if(t&1&&(a(0,"td",21),p(1,et,5,3,"span",25)(2,tt,2,0,"ng-template",null,1,L),r()),t&2){let e=m.$implicit,i=C(3),n=u(2);N("premio-winner",H(4,U).includes(n.lotteryNumber)?!1:n.calculatePrize(e).isWinner),l(),s("ngIf",H(5,U).includes(n.lotteryNumber)?!1:n.calculatePrize(e).isWinner)("ngIfElse",i)}}function it(t,m){t&1&&k(0,"tr",28)}function ot(t,m){t&1&&k(0,"tr",29)}function at(t,m){if(t&1&&(a(0,"table",9),M(1,10),p(2,Le,2,0,"th",11)(3,Ae,2,1,"td",12),S(),M(4,13),p(5,Ue,2,0,"th",11)(6,Ge,2,1,"td",12),S(),M(7,14),p(8,Je,2,0,"th",11)(9,Ke,4,2,"td",12),S(),M(10,15),p(11,Xe,2,0,"th",11)(12,Ye,3,3,"td",12),S(),M(13,16),p(14,Ze,2,0,"th",11)(15,nt,4,6,"td",17),S(),p(16,it,1,0,"tr",18)(17,ot,1,0,"tr",19),r()),t&2){let e=u();s("dataSource",e.dataSource),l(16),s("matHeaderRowDef",e.displayedColumns),l(),s("matRowDefColumns",e.displayedColumns)}}function rt(t,m){if(t&1&&(a(0,"div",30),c(1),z(2,"currency"),r()),t&2){let e=u();l(),h(" ","Total Premios: "+R(2,1,e.totalPaymentWinner)," ")}}function lt(t,m){if(t&1){let e=w();a(0,"mat-paginator",31),_("page",function(n){g(e);let d=u();return f(d.onPageChange(n))}),r()}if(t&2){let e=u();s("length",e.totalItems)("pageSize",e.pageSize)("pageIndex",e.pageIndex>0?e.pageIndex-1:0)("pageSizeOptions",e.arraySize)}}var Ve=(()=>{class t{constructor(e){this.cdr=e,this.queries=new x,this.loading=!1,this.registerBetsUseCase=O(He),this.notification=O(B),this.dataSource=[],this.paymentDataSource=[],this.displayedColumns=["numero","vendedor","combinado","valor","premio"],this.pageIndex=1,this.pageSize=10,this.totalItems=0,this.lotteryNumber="",this.arraySize=[10,20,50,100],this.totalPaymentWinner=0}ngOnInit(){return T(this,null,function*(){yield this.getDataSource(),this.getPaymentParameterization(),this.queries.subscribe(e=>T(this,null,function*(){this.lotteryNumber=e.find(i=>i.lotteryNumber)?.lotteryNumber||"",yield this.getDataSource(e),this.calculatePaymentWinner()}))})}ngOnDestroy(){}getDataSource(e){return T(this,null,function*(){this.loading=!0;try{this.totalItems=yield this.registerBetsUseCase.getTotalBetsByQueries(e),e&&e.length>0?(this.pageSize=this.totalItems,this.arraySize=[this.totalItems]):(this.pageSize=10,this.arraySize=[10,20,50,100]),this.dataSource=yield this.registerBetsUseCase.getBetsByPagination(this.pageIndex,this.pageSize,e)}catch(i){this.notification.error("Error al cargar los vendedores: "+i.message)}finally{this.loading=!1}this.cdr.detectChanges()})}getPaymentParameterization(){localStorage.getItem("paymentDataSource");let e=localStorage.getItem("paymentDataSource");e?this.paymentDataSource=JSON.parse(e):this.paymentDataSource=[]}onPageChange(e){this.pageIndex=e.pageIndex===0?1:e.pageIndex+1,this.pageSize=e.pageSize,this.getDataSource()}calculatePrize(e){let i,n=!1,d=[],y=this.lotteryNumber;for(let o=0;o<this.lotteryNumber.length;o++){let G=y.slice(o+1);G.length!==0&&d.push(G)}if(e.lotteryNumber&&d.includes(e.lotteryNumber)&&e.combined===!1){if(i=this.paymentDataSource.find(o=>o.digits===e.lotteryNumber?.length&&o.combined===!1),!i)return{isWinner:!1,value:0};n=!0}else if(this.lotteryNumber.length!==e.lotteryNumber?.length&&[1,2].includes(e.lotteryNumber?.length)){if(i=this.paymentDataSource.find(o=>o.digits===e.lotteryNumber?.length&&o.combined===e.combined),!i)return{isWinner:!1,value:0};n=!0}else if(this.lotteryNumber.length!==e.lotteryNumber?.length&&[3].includes(e.lotteryNumber?.length)&&e.combined===!1&&d.includes(e.lotteryNumber)){if(i=this.paymentDataSource.find(o=>o.digits===e.lotteryNumber?.length&&o.combined===!1&&d.includes(e.lotteryNumber)),!i)return{isWinner:!1,value:0};console.log("payment",i),n=!0}else if(this.lotteryNumber.length!==e.lotteryNumber?.length&&[3].includes(e.lotteryNumber?.length)&&e.combined===!0){if(console.log(e),i=this.paymentDataSource.find(o=>o.digits===e.lotteryNumber?.length&&o.combined===!0&&o.combined==e.combined),!i)return{isWinner:!1,value:0};console.log("payment",i),n=!0}else if(this.lotteryNumber!==e.lotteryNumber&&this.lotteryNumber.length===e.lotteryNumber?.length&&e.combined===!0){if(i=this.paymentDataSource.find(o=>o.digits===e.lotteryNumber?.length&&o.combined===!0),!i)return{isWinner:!1,value:0};n=!0}else if(this.lotteryNumber===e.lotteryNumber&&e.combined===!0){if(i=this.paymentDataSource.find(o=>o.digits===e.lotteryNumber?.length&&o.combined===!0),!i)return{isWinner:!1,value:0};n=!0}else if(this.lotteryNumber===e.lotteryNumber&&e.combined===!1){if(i=this.paymentDataSource.find(o=>o.digits===e.lotteryNumber?.length&&o.combined===!1),!i)return{isWinner:!1,value:0};n=!0}return{isWinner:n,value:i?.amount*e.value||0}}calculatePaymentWinner(){this.totalPaymentWinner=this.dataSource.reduce((e,i)=>{let n=this.calculatePrize(i);return e+(n.isWinner?n.value:0)},0)}static{this.\u0275fac=function(i){return new(i||t)(I(W))}}static{this.\u0275cmp=b({type:t,selectors:[["app-check-hits-table"]],inputs:{queries:"queries",loading:"loading"},standalone:!0,features:[P],decls:6,vars:5,consts:[["noCombinado",""],["noPremio",""],[2,"background-color","white","border-radius","8px","padding","20px","box-shadow","0 2px 10px rgba(0,0,0,0.1)"],["class","loading-container",4,"ngIf"],[1,"table-responsive"],["mat-table","",3,"dataSource",4,"ngIf"],["class","totalValue","style","text-align: right; color: red; padding-right: 10px; font-weight: 600; background-color: #FFFFFF;",4,"ngIf"],["showFirstLastButtons","","aria-label","Seleccionar p\xE1gina de vendedores",3,"length","pageSize","pageIndex","pageSizeOptions","page",4,"ngIf"],[1,"loading-container"],["mat-table","",3,"dataSource"],["matColumnDef","numero"],["mat-header-cell","","style","text-align: right;",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right;",4,"matCellDef"],["matColumnDef","vendedor"],["matColumnDef","combinado"],["matColumnDef","valor"],["matColumnDef","premio"],["mat-cell","","style","text-align: right;",3,"premio-winner",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["matTooltip","Combinado","style","display: flex; align-items: center; gap: 4px; justify-content: flex-end;","class","combinado",4,"ngIf","ngIfElse"],["matTooltip","Combinado",1,"combinado",2,"display","flex","align-items","center","gap","4px","justify-content","flex-end"],["matTooltip","No Combinado",1,"no-combinado",2,"display","flex","align-items","center","gap","4px","justify-content","flex-end"],["style","display: flex; align-items: center; gap: 4px; justify-content: flex-end;",4,"ngIf","ngIfElse"],[2,"display","flex","align-items","center","gap","4px","justify-content","flex-end"],[1,"no-prize",2,"display","flex","align-items","center","gap","4px","justify-content","flex-end"],["mat-header-row",""],["mat-row",""],[1,"totalValue",2,"text-align","right","color","red","padding-right","10px","font-weight","600","background-color","#FFFFFF"],["showFirstLastButtons","","aria-label","Seleccionar p\xE1gina de vendedores",3,"page","length","pageSize","pageIndex","pageSizeOptions"]],template:function(i,n){i&1&&(a(0,"div",2),p(1,je,3,0,"div",3),a(2,"div",4),p(3,at,18,3,"table",5)(4,rt,3,3,"div",6),r(),p(5,lt,1,4,"mat-paginator",7),r()),i&2&&(l(),s("ngIf",n.loading),l(2),s("ngIf",!n.loading),l(),s("ngIf",!H(4,U).includes(n.lotteryNumber)&&!n.loading),l(),s("ngIf",!n.loading))},dependencies:[Ie,xe,Me,ve,Se,be,Oe,we,Pe,ke,Te,Ee,Fe,v,V,X,ge,ue],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{padding:20px;height:100%;display:flex;flex-direction:column;max-width:800px;margin:0 auto}.mat-elevation-z8[_ngcontent-%COMP%]{border-radius:8px 8px 0 0!important;box-shadow:0 2px 8px #0000001a}table[_ngcontent-%COMP%]{width:100%;overflow:hidden;flex:1}.table-row[_ngcontent-%COMP%]{height:20px!important}.mat-mdc-header-row[_ngcontent-%COMP%]{height:40px!important}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:4px 12px!important;font-size:14px;line-height:1.2}.loading-container[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#666;font-style:italic}.premio-winner[_ngcontent-%COMP%]{font-weight:600;color:#4caf50}.combinado[_ngcontent-%COMP%]{font-weight:600;color:#03fc0c}.no-combinado[_ngcontent-%COMP%]{font-weight:600;color:#f70505}.no-prize[_ngcontent-%COMP%]{color:#999;font-style:italic}.totalValue[_ngcontent-%COMP%]{font-weight:600;background-color:#fff}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]{padding:16px}table[_ngcontent-%COMP%]{font-size:14px}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:3px 6px!important}.table-row[_ngcontent-%COMP%]{height:28px!important}}@media (min-width: 1025px){.table-container[_ngcontent-%COMP%]{padding:0;height:calc(100vh - 40px);max-width:100%;margin:0}}']})}}return t})();function mt(t,m){if(t&1){let e=w();a(0,"div",7)(1,"div",7)(2,"app-check-hits-form",8),_("searchResults",function(n){g(e);let d=u();return f(d.onSearchResults(n))}),r()()()}if(t&2){let e=u();l(2),s("queries",e.queries)}}var Xt=(()=>{class t{constructor(){this.queries=new x,this.searchResults=[],this.loading=!1,this.showForm=!1,this.isMobile=!1}ngOnInit(){}ngOnDestroy(){this.queries.complete()}onSearchResults(e){this.searchResults=e}toggleForm(){this.showForm=!this.showForm}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=b({type:t,selectors:[["app-check-hits"]],standalone:!0,features:[P],decls:8,vars:6,consts:[[1,"alert-layout"],[1,"toolbar"],["mat-raised-button","","color","primary",3,"click"],[1,"layout"],["class","form-section",4,"ngIf"],[1,"table-section"],[3,"loading","queries"],[1,"form-section"],[3,"searchResults","queries"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),_("click",function(){return n.toggleForm()}),c(3),r()(),a(4,"div",3),p(5,mt,3,1,"div",4),a(6,"div",5),k(7,"app-check-hits-table",6),r()()()),i&2&&(l(3),h(" ",n.showForm?"Ocultar formulario":"Consultar aciertos"," "),l(),N("column",n.isMobile),l(),s("ngIf",n.showForm),l(2),s("loading",n.loading)("queries",n.queries))},dependencies:[We,Ve,v,V,j,q],styles:[".layout[_ngcontent-%COMP%]{display:flex;gap:24px;padding:20px;box-sizing:border-box}.layout.column[_ngcontent-%COMP%]{flex-direction:column}.layout.column[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%], .layout.column[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{width:100%;flex:none}.form-section[_ngcontent-%COMP%]{flex:0 0 350px;min-width:0}.table-section[_ngcontent-%COMP%]{flex:1;min-width:0}.toolbar[_ngcontent-%COMP%]{padding:16px 20px 0}@media screen and (max-width: 1300px){.layout[_ngcontent-%COMP%]{flex-direction:column}.form-section[_ngcontent-%COMP%]{flex:none;width:100%}.table-section[_ngcontent-%COMP%]{width:100%}}"]})}}return t})();export{Xt as CheckHitsPage};
