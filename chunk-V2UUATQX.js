import{b as se}from"./chunk-PIRFJXWV.js";import{d as O,k as ee}from"./chunk-75NA3FSW.js";import{a as te,b as ie}from"./chunk-ZXHD5R5S.js";import"./chunk-FVKXXHM4.js";import"./chunk-PMOG4S75.js";import{b as ae}from"./chunk-7TTS24RX.js";import{a as re,c as ne}from"./chunk-QHZRYLVR.js";import{b as oe}from"./chunk-X67Z44SH.js";import"./chunk-DOKGUGK4.js";import{b as Z}from"./chunk-JCPCU3BD.js";import{Aa as W,C as k,E as D,F as N,L as A,fa as z,ga as B,ha as R,ia as j,la as q,na as G,pa as H,sa as V,sb as X,t as T,ua as J,ub as Y,v,va as $,wb as P,xa as K,y as L,ya as Q,z as U}from"./chunk-RQCRWK54.js";import{Ab as u,Bb as E,Ca as S,Cb as F,Hb as g,Jc as C,Qc as x,Sb as a,Ub as I,Wa as n,Zb as h,fa as l,hb as w,ka as _,nb as p,ob as M,pb as s,yb as o,zb as r}from"./chunk-UIILES4X.js";import{e as d}from"./chunk-DVOCWXDE.js";function de(t,f){t&1&&(o(0,"mat-error"),a(1,"Requerido"),r())}function pe(t,f){t&1&&(o(0,"mat-error"),a(1,"Email inv\xE1lido"),r())}function ue(t,f){t&1&&(o(0,"mat-error"),a(1,"Requerido"),r())}function ge(t,f){t&1&&(E(0),a(1,"Entrar"),F())}function fe(t,f){t&1&&u(0,"mat-progress-spinner",16)}var me=(()=>{class t{constructor(){this.disabled=!1,this.logBookUseCases=l(oe),this.currentUser=l(Z),this.fb=l(A),this.loginUseCase=l(ee),this.notification=l(Y),this.loginSuccess=new S,this.recoverPassword=new S,this.loading=!1,this.form=this.fb.group({email:["",[v.required,v.email]],password:["",v.required]}),this.hidePassword=w(!0)}login(){return d(this,null,function*(){if(this.form.invalid)return;this.loading=!0;let{email:m,password:i}=this.form.value;try{yield this.loginUseCase.execute(m,i).then(()=>{let e=this.currentUser.getUser();this.logBookUseCases.createLogBook({date:new Date().valueOf(),action:re.AUTHENTICATE,user:e,module:ne.AUTH,description:`Usuario ${e?.name} inici\xF3 sesi\xF3n`})}),this.notification.success("Inicio de sesi\xF3n exitoso"),this.loginSuccess.emit()}catch(e){this.notification.error(ie(e))}finally{this.loading=!1}})}goToRecoverPassword(){this.recoverPassword.emit()}clickEvent(m){this.hidePassword.set(!this.hidePassword()),m.stopPropagation()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["app-login-form"]],inputs:{disabled:"disabled"},outputs:{loginSuccess:"loginSuccess",recoverPassword:"recoverPassword"},standalone:!0,features:[h],decls:32,vars:10,consts:[[1,"login-container"],[1,"login-card"],[1,"title"],["mat-card-avatar","","color","primary"],[1,"login-form",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matPrefix",""],["matInput","","formControlName","email","type","email","autocomplete","email"],[4,"ngIf"],["matInput","","formControlName","password","autocomplete","current-password",3,"type"],["matSuffix","","tabindex","0",1,"clickable-icon",3,"click"],[1,"actions"],["mat-flat-button","","color","primary","type","submit",1,"btn-loading",3,"disabled"],["diameter","20","mode","indeterminate","color","accent",4,"ngIf"],[1,"recover"],["mat-stroked-button","","color","accent","type","button",3,"click"],["diameter","20","mode","indeterminate","color","accent"]],template:function(i,e){if(i&1&&(o(0,"div",0)(1,"mat-card",1)(2,"mat-card-header",2)(3,"mat-icon",3),a(4,"account_circle"),r(),o(5,"mat-card-title"),a(6,"Iniciar sesi\xF3n"),r()(),o(7,"form",4),g("ngSubmit",function(){return e.login()}),o(8,"mat-form-field",5)(9,"mat-label"),a(10,"Correo electr\xF3nico"),r(),o(11,"mat-icon",6),a(12,"email"),r(),u(13,"input",7),p(14,de,2,0,"mat-error",8)(15,pe,2,0,"mat-error",8),r(),o(16,"mat-form-field",5)(17,"mat-label"),a(18,"Contrase\xF1a"),r(),o(19,"mat-icon",6),a(20,"lock"),r(),u(21,"input",9),o(22,"mat-icon",10),g("click",function(){return e.hidePassword.set(!e.hidePassword())}),a(23),r(),p(24,ue,2,0,"mat-error",8),r(),o(25,"div",11)(26,"button",12),p(27,ge,2,0,"ng-container",8)(28,fe,1,0,"mat-progress-spinner",13),r()()(),o(29,"div",14)(30,"button",15),g("click",function(){return e.goToRecoverPassword()}),a(31," \xBFOlvidaste tu contrase\xF1a? "),r()()()()),i&2){let c,y,b;n(7),s("formGroup",e.form),n(7),s("ngIf",(c=e.form.get("email"))==null?null:c.hasError("required")),n(),s("ngIf",(y=e.form.get("email"))==null?null:y.hasError("email")),n(6),s("type",e.hidePassword()?"password":"text"),n(),M("aria-label",e.hidePassword()?"Mostrar contrase\xF1a":"Ocultar contrase\xF1a"),n(),I(" ",e.hidePassword()?"visibility_off":"visibility"," "),n(),s("ngIf",(b=e.form.get("password"))==null?null:b.hasError("required")),n(2),s("disabled",e.loading||e.disabled),n(),s("ngIf",!e.loading),n(),s("ngIf",e.loading)}},dependencies:[te,C,k,T,L,U,D,N,P,q,z,B,R,j,G,H,V,J,Q,K,$,W],styles:[".title[_ngcontent-%COMP%]{justify-content:center}.login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#e3f2fd,#f5f5f5);padding:1rem}.login-card[_ngcontent-%COMP%]{width:100%;max-width:420px;padding:2rem;border-radius:1rem;box-shadow:0 12px 30px #0003;background:#fff;transition:all .3s ease}.full-width[_ngcontent-%COMP%]{width:100%}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-top:1rem}.login-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{font-size:15px}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;height:44px;font-weight:600;letter-spacing:.5px;position:relative;display:flex;align-items:center;justify-content:center}.btn-loading[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;min-width:120px;justify-content:center}.recover[_ngcontent-%COMP%]{margin-top:1.5rem;text-align:center}.clickable-icon[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}"]})}}return t})();function _e(t,f){t&1&&u(0,"mat-progress-bar",3)}var Qe=(()=>{class t{constructor(){this.router=l(O),this.alertParameterizationUseCase=l(ae),this.paymentParameterizationUseCase=l(se),this.loading=!1}onLoginSuccess(){return d(this,null,function*(){this.loading=!0,yield Promise.all([this.getAlertDataSource(),this.getPaymentDataSource()]),this.router.navigate(["/dashboard"])})}onRecoverPassword(){this.router.navigate(["/auth/recover-password"])}getAlertDataSource(){return d(this,null,function*(){let m=yield this.alertParameterizationUseCase.listAlertParameterizations();localStorage.removeItem("alertDataSource"),localStorage.setItem("alertDataSource",JSON.stringify(m.map(i=>(delete i.uid,delete i.id,i))))})}getPaymentDataSource(){return d(this,null,function*(){let m=yield this.paymentParameterizationUseCase.listPaymentParameterizations();localStorage.removeItem("paymentDataSource"),localStorage.setItem("paymentDataSource",JSON.stringify(m.map(i=>(delete i.uid,i))))})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=_({type:t,selectors:[["app-login-page"]],standalone:!0,features:[h],decls:3,vars:2,consts:[[1,"login-page-container"],["mode","indeterminate","color","primary","class","progress-bar",4,"ngIf"],[3,"loginSuccess","recoverPassword","disabled"],["mode","indeterminate","color","primary",1,"progress-bar"]],template:function(i,e){i&1&&(o(0,"div",0),p(1,_e,1,0,"mat-progress-bar",1),o(2,"app-login-form",2),g("loginSuccess",function(){return e.onLoginSuccess()})("recoverPassword",function(){return e.onRecoverPassword()}),r()()),i&2&&(n(),s("ngIf",e.loading),n(),s("disabled",e.loading))},dependencies:[me,x,C,P,X],encapsulation:2})}}return t})();export{Qe as LoginPageComponent};
