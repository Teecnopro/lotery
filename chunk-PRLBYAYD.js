import{a as He}from"./chunk-4AYCMPBR.js";import{a as Ue,b as S}from"./chunk-OPZHAL75.js";import{a as Le}from"./chunk-3ZIDYFSV.js";import{a as $e}from"./chunk-USWFCF42.js";import"./chunk-XFEE3PRU.js";import{a as F,c as D}from"./chunk-QHZRYLVR.js";import{a as E,b as j}from"./chunk-X67Z44SH.js";import{b as H}from"./chunk-JCPCU3BD.js";import"./chunk-DOKGUGK4.js";import{k as Ne,p as Ve,q as ke}from"./chunk-NN2UDVZC.js";import{A as oe,Aa as L,B as re,Ba as _e,Ca as $,Da as he,E as le,Ea as be,F as me,Fa as Ce,Ga as xe,H as de,Ha as Me,Ia as Oe,Ka as we,bb as ve,cb as Ae,db as Te,fb as Pe,gb as Ee,ib as Se,jb as ye,lb as Fe,ma as se,mb as De,oa as ce,ob as Ie,pb as ze,r as ee,sb as Be,va as pe,vb as Re,w as te,wa as ue,x as ie,y as ne,ya as fe,yb as P,z as ae,za as ge}from"./chunk-KWAI636N.js";import{Ab as v,Bb as b,Cb as C,Eb as z,Hb as M,Jb as A,Jc as k,Oc as X,Qc as U,Rb as B,Sb as o,Ub as f,Vb as R,Wa as m,Wb as N,Xa as Z,Xb as V,Yb as J,Zb as T,bc as W,dc as Y,f as I,fa as g,ka as w,nb as u,pb as p,qc as Q,rb as K,t as G,ta as _,ua as h,yb as i,zb as n}from"./chunk-UIILES4X.js";import{a as y,b as q,e as x}from"./chunk-DVOCWXDE.js";var je=(()=>{class e{constructor(t){this.cdr=t,this.alertObservable=null,this.updateTable=null,this.user=g(H),this.alertUseCases=g(S),this.logBook=g(E),this.notification=g(P),this.textButton="Crear Alerta",this.alert={},this.isEditing=!1,this.loading=!1}ngOnInit(){this.alertObservable&&(this.subscription=this.alertObservable.subscribe(t=>{t&&t.uid!==void 0&&(this.textButton="Editar Alerta",this.isEditing=!0),this.alert=y({},t),this.cdr.detectChanges()}))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}onSubmit(t){return x(this,null,function*(){if(!t.valid){this.notification.error("Por favor, complete todos los campos requeridos");return}let l=this.user.getUser();if(!l){this.notification.error("Usuario no autenticado");return}this.loading=!0;let a=y({},t.value),s=y({},this.alert),c=q(y({},this.alert),{value:a.value,description:a.description.trim(),digits:a.digits});try{if((yield this.alertUseCases.getAlertParameterizationsByValue(c.value,c.digits))&&!this.isEditing){this.notification.error("Ya existe una parametrizaci\xF3n de alerta con este valor"),this.loading=!1;return}this.isEditing?(c.updatedBy=l,c.updatedAt=Date.now(),yield this.alertUseCases.updateAlertParameterization(c.uid,c).then(O=>x(this,null,function*(){yield this.logBook.createLogBook({action:F.UPDATE,user:l,date:Date.now().valueOf(),module:D.ALERT_PARAMETERIZATION,description:`Se actualiz\xF3 la parametrizaci\xF3n de alerta con id ${O.uid} de valor ${s.value} a ${O.value} y d\xEDgitos de ${s.digits} a ${O.digits}`})}))):(c.uid=`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c.createdBy=l,c.createdAt=Date.now(),yield this.alertUseCases.createAlertParameterization(c).then(O=>x(this,null,function*(){yield this.logBook.createLogBook({action:F.CREATE,user:l,date:Date.now().valueOf(),module:D.ALERT_PARAMETERIZATION,description:`Se cre\xF3 una nueva parametrizaci\xF3n de alerta con valor ${O.value} y d\xEDgitos ${O.digits}`})}))),this.notification.success(`Parametrizaci\xF3n de alerta ${this.isEditing?"actualizada":"creada"} exitosamente`),this.limpiarFormulario(t),this.loading=!1,this.updateTable?.next(!0)}catch(d){console.error("Error saving alert parameterization:",d),this.notification.error(d?.message||"Error al guardar la parametrizaci\xF3n de alerta"),this.loading=!1}finally{this.loading=!1}})}limpiarFormulario(t){t.resetForm(),this.textButton="Crear Alerta",this.isEditing=!1,this.alert={},this.cdr.detectChanges()}static{this.\u0275fac=function(l){return new(l||e)(Z(Q))}}static{this.\u0275cmp=w({type:e,selectors:[["app-alert-form"]],inputs:{alertObservable:"alertObservable",updateTable:"updateTable"},standalone:!0,features:[T],decls:25,vars:7,consts:[["alertForm","ngForm"],[1,"form-container"],[1,"form-card"],[1,"alert-form",3,"ngSubmit"],["appearance","outline",1,"full-width"],["matInput","","type","number","name","digits","required","","placeholder","Ingrese la cantidad de d\xEDgitos",3,"ngModelChange","ngModel","min"],["matInput","","type","number","name","value","required","","placeholder","Ingrese el valor",3,"ngModelChange","ngModel","min"],["matInput","","type","text","name","description","required","","placeholder","Ingrese una Descripci\xF3n",3,"ngModelChange","ngModel"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-outlined-button","","type","button",3,"click"]],template:function(l,a){if(l&1){let s=z();i(0,"div",1)(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title"),o(4,"Configuraci\xF3n de Alertas"),n()(),i(5,"mat-card-content")(6,"form",3,0),M("ngSubmit",function(){_(s);let d=B(7);return h(a.onSubmit(d))}),i(8,"mat-form-field",4)(9,"mat-label"),o(10,"Dig\xEDtos"),n(),i(11,"input",5),V("ngModelChange",function(d){return _(s),N(a.alert.digits,d)||(a.alert.digits=d),h(d)}),n()(),i(12,"mat-form-field",4)(13,"mat-label"),o(14,"Valor"),n(),i(15,"input",6),V("ngModelChange",function(d){return _(s),N(a.alert.value,d)||(a.alert.value=d),h(d)}),n()(),i(16,"mat-form-field",4)(17,"mat-label"),o(18,"Descripci\xF3n Alerta"),n(),i(19,"input",7),V("ngModelChange",function(d){return _(s),N(a.alert.description,d)||(a.alert.description=d),h(d)}),n()(),i(20,"div",8)(21,"button",9),o(22),n(),i(23,"button",10),M("click",function(){_(s);let d=B(7);return h(a.limpiarFormulario(d))}),o(24," Limpiar "),n()()()()()()}if(l&2){let s=B(7);m(11),R("ngModel",a.alert.digits),p("min",1),m(4),R("ngModel",a.alert.value),p("min",1),m(4),R("ngModel",a.alert.description),m(2),p("disabled",!s.valid),m(),f(" ",a.textButton," ")}},dependencies:[de,oe,ee,re,te,ie,me,le,ae,ne,ue,pe,ce,ge,fe,Be,se,$,L,we,Ce,Me,Oe,xe],styles:[".form-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;padding:15px;height:fit-content}.form-card[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:16px;border-radius:8px;box-shadow:0 2px 8px #0000001a}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:12px;text-align:center}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;color:#333;margin:0}.alert-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.alert-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.alert-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{border-radius:4px}.button-group[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:center;margin-top:12px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:90px;height:36px;border-radius:4px;font-weight:500;font-size:14px}.button-group[_ngcontent-%COMP%]   button[color=primary][_ngcontent-%COMP%]:disabled{background:#ccc;color:#999}@media (max-width: 768px){.form-container[_ngcontent-%COMP%], .form-card[_ngcontent-%COMP%]{padding:12px}.button-group[_ngcontent-%COMP%]{flex-direction:column}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}@media (min-width: 1025px){.form-container[_ngcontent-%COMP%]{padding:0;height:auto}.form-card[_ngcontent-%COMP%]{max-width:350px}}"]})}}return e})();function Ze(e,r){e&1&&(i(0,"div",2)(1,"p"),o(2,"Cargando parametrizaciones de alerta..."),n()())}function Ke(e,r){e&1&&(i(0,"th",17),o(1," D\xEDgitos "),n())}function Je(e,r){if(e&1&&(i(0,"td",18),o(1),n()),e&2){let t=r.$implicit;m(),f(" ",t.digits," ")}}function Qe(e,r){e&1&&(i(0,"th",17),o(1," Valor "),n())}function Xe(e,r){if(e&1&&(i(0,"td",18),o(1),n()),e&2){let t=r.$implicit;m(),f(" ",t.value," ")}}function et(e,r){e&1&&(i(0,"th",17),o(1," Descripci\xF3n "),n())}function tt(e,r){if(e&1&&(i(0,"td",18),o(1),n()),e&2){let t=r.$implicit;m(),f(" ",t.description||"N/A"," ")}}function it(e,r){e&1&&(i(0,"th",17),o(1," Creado por "),n())}function nt(e,r){if(e&1&&(i(0,"td",18),o(1),n()),e&2){let t=r.$implicit;m(),f(" ",(t.createdBy==null?null:t.createdBy.name)||"N/A"," ")}}function at(e,r){e&1&&(i(0,"th",17),o(1," Fecha de creaci\xF3n "),n())}function ot(e,r){if(e&1&&(i(0,"td",18),o(1),W(2,"date"),n()),e&2){let t=r.$implicit;m(),f(" ",t.createdAt?Y(2,1,t.createdAt,"dd-MM-YYYY hh:mm:ss"):"N/A"," ")}}function rt(e,r){e&1&&(i(0,"th",17),o(1," Actualizado por "),n())}function lt(e,r){if(e&1&&(i(0,"td",18),o(1),n()),e&2){let t=r.$implicit;m(),f(" ",(t.updatedBy==null?null:t.updatedBy.name)||"N/A"," ")}}function mt(e,r){e&1&&(i(0,"th",17),o(1," \xDAltima actualizaci\xF3n "),n())}function dt(e,r){if(e&1&&(i(0,"td",18),o(1),W(2,"date"),n()),e&2){let t=r.$implicit;m(),f(" ",t.updatedAt?Y(2,1,t.updatedAt,"dd-MM-YYYY hh:mm:ss"):"N/A"," ")}}function st(e,r){e&1&&(i(0,"th",19),o(1," Acciones "),n())}function ct(e,r){if(e&1){let t=z();i(0,"td",18)(1,"button",20),M("click",function(){let a=_(t).$implicit,s=A(2);return h(s.editAlert(a))}),i(2,"mat-icon"),o(3,"edit"),n()(),i(4,"button",21),M("click",function(){let a=_(t).$implicit,s=A(2);return h(s.deleteAlert(a))}),i(5,"mat-icon"),o(6,"delete"),n()()()}}function pt(e,r){e&1&&v(0,"tr",22)}function ut(e,r){e&1&&v(0,"tr",23)}function ft(e,r){if(e&1&&(i(0,"table",3),b(1,4),u(2,Ke,2,0,"th",5)(3,Je,2,1,"td",6),C(),b(4,7),u(5,Qe,2,0,"th",5)(6,Xe,2,1,"td",6),C(),b(7,8),u(8,et,2,0,"th",5)(9,tt,2,1,"td",6),C(),b(10,9),u(11,it,2,0,"th",5)(12,nt,2,1,"td",6),C(),b(13,10),u(14,at,2,0,"th",5)(15,ot,3,4,"td",6),C(),b(16,11),u(17,rt,2,0,"th",5)(18,lt,2,1,"td",6),C(),b(19,12),u(20,mt,2,0,"th",5)(21,dt,3,4,"td",6),C(),b(22,13),u(23,st,2,0,"th",14)(24,ct,7,0,"td",6),C(),u(25,pt,1,0,"tr",15)(26,ut,1,0,"tr",16),n()),e&2){let t=A();p("dataSource",t.dataSource),m(25),p("matHeaderRowDef",t.displayedColumns),m(),p("matRowDefColumns",t.displayedColumns)}}var qe=(()=>{class e{constructor(){this.alertObservable=null,this.updateTable=null,this.showFormObservable=null,this.alertParameterizationUseCase=g(S),this.logBook=g(E),this.notification=g(P),this.dialog=g(Ne),this.user=g(H),this.loading=!1,this.dataSource=[],this.displayedColumns=["digits","value","description","createdBy","createdAt","updatedBy","updatedAt","actions"]}ngOnInit(){this.getDataSource(),this.updateTable?.subscribe(()=>{this.getDataSource()})}getDataSource(){return x(this,null,function*(){this.loading=!0;try{let t=yield this.alertParameterizationUseCase.listAlertParameterizations();this.dataSource=t,this.loading=!1}catch(t){console.error("Error fetching alert parameterizations:",t),this.notification.error(t?.message||"Error al cargar las parametrizaciones de alerta"),this.loading=!1}})}editAlert(t){this.showFormObservable?.next(!0),setTimeout(()=>{this.alertObservable?.next(t)},100)}deleteAlert(t){return x(this,null,function*(){let l=this.dialog.open($e,{data:{title:"Eliminar parametrizaci\xF3n de alerta",message:"\xBFEst\xE1 seguro que desea eliminar esta parametrizaci\xF3n de alerta?"}});if(yield G(l.afterClosed()))try{yield this.alertParameterizationUseCase.deleteAlertParameterization(t.uid).then(()=>x(this,null,function*(){yield this.logBook.createLogBook({action:F.DELETE,user:this.user.getUser(),date:Date.now().valueOf(),module:D.ALERT_PARAMETERIZATION,description:`Se elimin\xF3 la parametrizaci\xF3n de alerta con id ${t.uid}`})})),this.notification.success("Parametrizaci\xF3n de alerta eliminada exitosamente"),this.getDataSource()}catch(s){console.error("Error deleting alert parameterization:",s),this.notification.error(s?.message||"Error al eliminar la parametrizaci\xF3n de alerta")}})}static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275cmp=w({type:e,selectors:[["app-alert-table"]],inputs:{alertObservable:"alertObservable",updateTable:"updateTable",showFormObservable:"showFormObservable"},standalone:!0,features:[T],decls:3,vars:2,consts:[["class","loading-container",4,"ngIf"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf"],[1,"loading-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","digits"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","value"],["matColumnDef","description"],["matColumnDef","createdBy"],["matColumnDef","createdAt"],["matColumnDef","updatedBy"],["matColumnDef","updatedAt"],["matColumnDef","actions"],["mat-header-cell","","class","actions-header",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"actions-header"],["mat-icon-button","","color","primary","title","Editar",3,"click"],["mat-icon-button","","color","warn","title","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(l,a){l&1&&(i(0,"div"),u(1,Ze,3,0,"div",0)(2,ft,27,3,"table",1),n()),l&2&&(m(),p("ngIf",a.loading),m(),p("ngIf",!a.loading))},dependencies:[ze,ve,Te,ye,Pe,Ae,Fe,Ee,Se,De,Ie,Re,$,_e,X,U,k,be,he],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{padding:20px;height:100%;display:flex;flex-direction:column;max-width:800px;margin:0 auto}.mat-elevation-z8[_ngcontent-%COMP%]{border-radius:8px 8px 0 0!important;box-shadow:0 2px 8px #0000001a}table[_ngcontent-%COMP%]{width:100%;overflow:hidden;flex:1}.table-row[_ngcontent-%COMP%]{height:20px!important}.mat-mdc-header-row[_ngcontent-%COMP%]{height:40px!important}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:4px 12px!important;font-size:14px;line-height:1.2}mat-paginator[_ngcontent-%COMP%]{border-radius:0 0 8px 8px!important;margin-top:0;box-shadow:0 2px 8px #0000001a}.actions-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 3px;width:90px!important;height:30px;font-size:15px;font-weight:500;border-radius:4px;line-height:1;padding:0 6px}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]{background-color:#ff9800;color:#fff}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]:hover{background-color:#f57c00}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]:hover{background-color:#d32f2f}.loading-container[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#666;font-style:italic}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]{padding:16px}table[_ngcontent-%COMP%]{font-size:14px}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:3px 6px!important}.table-row[_ngcontent-%COMP%]{height:28px!important}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:45px;height:20px;margin:0 1px;font-size:10px;padding:0 4px}}@media (min-width: 1025px){.table-container[_ngcontent-%COMP%]{padding:0;height:calc(100vh - 40px);max-width:100%;margin:0}}']})}}return e})();function gt(e,r){if(e&1&&(i(0,"div",7)(1,"div",7),v(2,"app-alert-form",8),n()()),e&2){let t=A();m(2),p("alertObservable",t.alertObservable)("updateTable",t.updateTable)}}var bi=(()=>{class e{constructor(){this.alertObservable=new I,this.updateTable=new I,this.showFormObservable=new I,this.showForm=!1,this.isMobile=!1}ngOnInit(){this.showFormObservable.next(!1),this.showFormObservable.subscribe(t=>{this.showForm=t})}ngOnDestroy(){this.alertObservable.complete(),this.updateTable.complete(),this.showFormObservable.complete()}toggleForm(){this.showForm=!this.showForm}static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275cmp=w({type:e,selectors:[["app-alert-parameterization-page"]],standalone:!0,features:[J([{provide:Ue,useClass:He},{provide:P,useClass:Ve},{provide:E,useClass:Le},j,S,j]),T],decls:8,vars:7,consts:[[1,"alert-layout"],[1,"toolbar"],["mat-raised-button","","color","primary",3,"click"],[1,"layout"],["class","form-section",4,"ngIf"],[1,"table-section"],[3,"alertObservable","updateTable","showFormObservable"],[1,"form-section"],[3,"alertObservable","updateTable"]],template:function(l,a){l&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),M("click",function(){return a.toggleForm()}),o(3),n()(),i(4,"div",3),u(5,gt,3,2,"div",4),i(6,"div",5),v(7,"app-alert-table",6),n()()()),l&2&&(m(3),f(" ",a.showForm?"Ocultar formulario":"Crear Alerta"," "),m(),K("column",a.isMobile),m(),p("ngIf",a.showForm),m(2),p("alertObservable",a.alertObservable)("updateTable",a.updateTable)("showFormObservable",a.showFormObservable))},dependencies:[je,qe,U,k,ke,L],styles:[".layout[_ngcontent-%COMP%]{display:flex;gap:24px;padding:20px;box-sizing:border-box}.layout.column[_ngcontent-%COMP%]{flex-direction:column}.layout.column[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%], .layout.column[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{width:100%;flex:none}.form-section[_ngcontent-%COMP%]{flex:0 0 350px;min-width:0}.table-section[_ngcontent-%COMP%]{flex:1;min-width:0}.toolbar[_ngcontent-%COMP%]{padding:16px 20px 0}"]})}}return e})();export{bi as AlertParameterizationPageComponent};
