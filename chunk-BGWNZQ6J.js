import{a as jt}from"./chunk-4AYCMPBR.js";import{a as Ht,b as E}from"./chunk-OPZHAL75.js";import{a as Wt}from"./chunk-3ZIDYFSV.js";import{a as Yt}from"./chunk-7DLEL2I7.js";import"./chunk-XFEE3PRU.js";import{a as F,c as I}from"./chunk-QHZRYLVR.js";import{a as y,b as q}from"./chunk-X67Z44SH.js";import{b as W}from"./chunk-JCPCU3BD.js";import"./chunk-DOKGUGK4.js";import{$ as ut,A as rt,B as lt,E as mt,F as st,H as dt,P as ct,Q as pt,Sa as Tt,Ta as St,Ua as yt,Wa as Et,Xa as Dt,Za as Ft,_a as It,aa as ft,ab as zt,bb as Bt,db as kt,eb as Rt,ha as gt,hb as Nt,ia as ht,jb as Vt,ka as _t,la as bt,lb as Ut,ma as $,na as Ct,oa as H,pa as xt,qa as Mt,r as et,ra as Ot,sa as wt,sb as S,ta as vt,tb as Lt,ua as Pt,ub as $t,w as it,wa as At,x as nt,y as at,z as ot}from"./chunk-DMRUWG6L.js";import{Ab as P,Bb as b,Cb as C,Eb as B,Hb as M,Jb as A,Jc as U,Oc as tt,Qc as L,Rb as k,Sb as o,Ub as g,Vb as R,W as K,Wa as m,Wb as N,Xa as J,Xb as V,Yb as Q,Zb as T,bc as Y,dc as j,f as w,fa as f,ka as v,nb as p,pb as u,qc as X,rb as z,t as Z,ta as h,ua as _,yb as i,zb as n}from"./chunk-UIILES4X.js";import{a as D,b as G,e as x}from"./chunk-DVOCWXDE.js";var Zt=(()=>{class t{constructor(e){this.cdr=e,this.alertObservable=null,this.updateTable=null,this.user=f(W),this.alertUseCases=f(E),this.breakpointObserver=f(ct),this.logBook=f(y),this.notification=f(S),this.destroy$=new w,this.textButton="Crear Alerta",this.alert={},this.isEditing=!1,this.isMobile=!1,this.loading=!1}ngOnInit(){this.alertObservable&&(this.subscription=this.alertObservable.subscribe(e=>{e&&e.uid!==void 0&&(this.textButton="Editar Alerta",this.isEditing=!0),this.alert=D({},e),this.cdr.detectChanges()}))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.destroy$.next(),this.destroy$.complete()}configResponsive(){this.breakpointObserver.observe([pt.Handset]).pipe(K(this.destroy$)).subscribe(e=>{this.isMobile=e.matches})}onSubmit(e){return x(this,null,function*(){if(!e.valid){this.notification.error("Por favor, complete todos los campos requeridos");return}let l=this.user.getUser();if(!l){this.notification.error("Usuario no autenticado");return}this.loading=!0;let a=D({},e.value),d=D({},this.alert),c=G(D({},this.alert),{value:a.value,description:a.description.trim(),digits:a.digits});try{if((yield this.alertUseCases.getAlertParameterizationsByValue(c.value,c.digits))&&!this.isEditing){this.notification.error("Ya existe una parametrizaci\xF3n de alerta con este valor"),this.loading=!1;return}this.isEditing?(c.updatedBy=l,c.updatedAt=Date.now(),yield this.alertUseCases.updateAlertParameterization(c.uid,c).then(O=>x(this,null,function*(){yield this.logBook.createLogBook({action:F.UPDATE,user:l,date:Date.now().valueOf(),module:I.ALERT_PARAMETERIZATION,description:`Se actualiz\xF3 la parametrizaci\xF3n de alerta con id ${O.uid} de valor ${d.value} a ${O.value} y d\xEDgitos de ${d.digits} a ${O.digits}`})}))):(c.uid=`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c.createdBy=l,c.createdAt=Date.now(),yield this.alertUseCases.createAlertParameterization(c).then(O=>x(this,null,function*(){yield this.logBook.createLogBook({action:F.CREATE,user:l,date:Date.now().valueOf(),module:I.ALERT_PARAMETERIZATION,description:`Se cre\xF3 una nueva parametrizaci\xF3n de alerta con valor ${O.value} y d\xEDgitos ${O.digits}`})}))),this.notification.success(`Parametrizaci\xF3n de alerta ${this.isEditing?"actualizada":"creada"} exitosamente`),this.limpiarFormulario(e),this.loading=!1,this.updateTable?.next(!0)}catch(s){console.error("Error saving alert parameterization:",s),this.notification.error(s?.message||"Error al guardar la parametrizaci\xF3n de alerta"),this.loading=!1}finally{this.loading=!1}})}limpiarFormulario(e){e.resetForm(),this.textButton="Crear Alerta",this.isEditing=!1,this.alert={},this.cdr.detectChanges()}static{this.\u0275fac=function(l){return new(l||t)(J(X))}}static{this.\u0275cmp=v({type:t,selectors:[["app-alert-form"]],inputs:{alertObservable:"alertObservable",updateTable:"updateTable"},standalone:!0,features:[T],decls:25,vars:9,consts:[["alertForm","ngForm"],[1,"form-container"],[1,"form-card"],[1,"alert-form",3,"ngSubmit"],["appearance","outline",1,"full-width"],["matInput","","type","number","name","digits","required","","placeholder","Ingrese la cantidad de d\xEDgitos",3,"ngModelChange","ngModel","min"],["matInput","","type","number","name","value","required","","placeholder","Ingrese el valor",3,"ngModelChange","ngModel","min"],["matInput","","type","text","name","description","required","","placeholder","Ingrese una Descripci\xF3n",3,"ngModelChange","ngModel"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-outlined-button","","type","button",3,"click"]],template:function(l,a){if(l&1){let d=B();i(0,"div",1)(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title"),o(4,"Configuraci\xF3n de Alertas"),n()(),i(5,"mat-card-content")(6,"form",3,0),M("ngSubmit",function(){h(d);let s=k(7);return _(a.onSubmit(s))}),i(8,"mat-form-field",4)(9,"mat-label"),o(10,"Dig\xEDtos"),n(),i(11,"input",5),V("ngModelChange",function(s){return h(d),N(a.alert.digits,s)||(a.alert.digits=s),_(s)}),n()(),i(12,"mat-form-field",4)(13,"mat-label"),o(14,"Valor"),n(),i(15,"input",6),V("ngModelChange",function(s){return h(d),N(a.alert.value,s)||(a.alert.value=s),_(s)}),n()(),i(16,"mat-form-field",4)(17,"mat-label"),o(18,"Descripci\xF3n Alerta"),n(),i(19,"input",7),V("ngModelChange",function(s){return h(d),N(a.alert.description,s)||(a.alert.description=s),_(s)}),n()(),i(20,"div",8)(21,"button",9),o(22),n(),i(23,"button",10),M("click",function(){h(d);let s=k(7);return _(a.limpiarFormulario(s))}),o(24," Limpiar "),n()()()()()()}if(l&2){let d=k(7);z("mobile",a.isMobile),m(11),R("ngModel",a.alert.digits),u("min",1),m(4),R("ngModel",a.alert.value),u("min",1),m(4),R("ngModel",a.alert.description),m(2),u("disabled",!d.valid),m(),g(" ",a.textButton," ")}},dependencies:[dt,rt,et,lt,it,nt,st,mt,ot,at,ht,gt,ft,bt,_t,Nt,ut,H,$,At,Ot,vt,Pt,wt],styles:[".form-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;padding:15px;height:fit-content}.form-card[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:16px;border-radius:8px;box-shadow:0 2px 8px #0000001a}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:12px;text-align:center}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;color:#333;margin:0}.alert-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.alert-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.alert-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{border-radius:4px}.button-group[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:center;margin-top:12px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:90px;height:36px;border-radius:4px;font-weight:500;font-size:14px}.button-group[_ngcontent-%COMP%]   button[color=primary][_ngcontent-%COMP%]:disabled{background:#ccc;color:#999}@media (max-width: 768px){.form-container[_ngcontent-%COMP%], .form-card[_ngcontent-%COMP%]{padding:12px}.button-group[_ngcontent-%COMP%]{flex-direction:column}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}@media (min-width: 1025px){.form-container[_ngcontent-%COMP%]{padding:0;height:auto}.form-card[_ngcontent-%COMP%]{max-width:350px}}"]})}}return t})();function Qt(t,r){t&1&&(i(0,"div",4)(1,"p"),o(2,"Cargando parametrizaciones de alerta..."),n()())}function Xt(t,r){t&1&&(i(0,"th",19),o(1," D\xEDgitos "),n())}function te(t,r){if(t&1&&(i(0,"td",20),o(1),n()),t&2){let e=r.$implicit;m(),g(" ",e.digits," ")}}function ee(t,r){t&1&&(i(0,"th",19),o(1," Valor "),n())}function ie(t,r){if(t&1&&(i(0,"td",20),o(1),n()),t&2){let e=r.$implicit;m(),g(" ",e.value," ")}}function ne(t,r){t&1&&(i(0,"th",19),o(1," Descripci\xF3n "),n())}function ae(t,r){if(t&1&&(i(0,"td",20),o(1),n()),t&2){let e=r.$implicit;m(),g(" ",e.description||"N/A"," ")}}function oe(t,r){t&1&&(i(0,"th",19),o(1," Creado por "),n())}function re(t,r){if(t&1&&(i(0,"td",20),o(1),n()),t&2){let e=r.$implicit;m(),g(" ",(e.createdBy==null?null:e.createdBy.name)||"N/A"," ")}}function le(t,r){t&1&&(i(0,"th",19),o(1," Fecha de creaci\xF3n "),n())}function me(t,r){if(t&1&&(i(0,"td",20),o(1),Y(2,"date"),n()),t&2){let e=r.$implicit;m(),g(" ",e.createdAt?j(2,1,e.createdAt,"dd-MM-YYYY hh:mm:ss"):"N/A"," ")}}function se(t,r){t&1&&(i(0,"th",19),o(1," Actualizado por "),n())}function de(t,r){if(t&1&&(i(0,"td",20),o(1),n()),t&2){let e=r.$implicit;m(),g(" ",(e.updatedBy==null?null:e.updatedBy.name)||"N/A"," ")}}function ce(t,r){t&1&&(i(0,"th",19),o(1," \xDAltima actualizaci\xF3n "),n())}function pe(t,r){if(t&1&&(i(0,"td",20),o(1),Y(2,"date"),n()),t&2){let e=r.$implicit;m(),g(" ",e.updatedAt?j(2,1,e.updatedAt,"dd-MM-YYYY hh:mm:ss"):"N/A"," ")}}function ue(t,r){t&1&&(i(0,"th",21),o(1," Acciones "),n())}function fe(t,r){if(t&1){let e=B();i(0,"td",20)(1,"button",22),M("click",function(){let a=h(e).$implicit,d=A(2);return _(d.editAlert(a))}),i(2,"mat-icon"),o(3,"edit"),n()(),i(4,"button",23),M("click",function(){let a=h(e).$implicit,d=A(2);return _(d.deleteAlert(a))}),i(5,"mat-icon"),o(6,"delete"),n()()()}}function ge(t,r){t&1&&P(0,"tr",24)}function he(t,r){t&1&&P(0,"tr",25)}function _e(t,r){if(t&1&&(i(0,"table",5),b(1,6),p(2,Xt,2,0,"th",7)(3,te,2,1,"td",8),C(),b(4,9),p(5,ee,2,0,"th",7)(6,ie,2,1,"td",8),C(),b(7,10),p(8,ne,2,0,"th",7)(9,ae,2,1,"td",8),C(),b(10,11),p(11,oe,2,0,"th",7)(12,re,2,1,"td",8),C(),b(13,12),p(14,le,2,0,"th",7)(15,me,3,4,"td",8),C(),b(16,13),p(17,se,2,0,"th",7)(18,de,2,1,"td",8),C(),b(19,14),p(20,ce,2,0,"th",7)(21,pe,3,4,"td",8),C(),b(22,15),p(23,ue,2,0,"th",16)(24,fe,7,0,"td",8),C(),p(25,ge,1,0,"tr",17)(26,he,1,0,"tr",18),n()),t&2){let e=A();u("dataSource",e.dataSource),m(25),u("matHeaderRowDef",e.displayedColumns),m(),u("matRowDefColumns",e.displayedColumns)}}var Kt=(()=>{class t{constructor(){this.alertObservable=null,this.updateTable=null,this.showFormObservable=null,this.alertParameterizationUseCase=f(E),this.logBook=f(y),this.notification=f(S),this.dialog=f(Ut),this.user=f(W),this.loading=!1,this.dataSource=[],this.isMobile=!1,this.displayedColumns=["digits","value","description","createdBy","createdAt","updatedBy","updatedAt","actions"]}ngOnInit(){this.getDataSource(),this.updateTable?.subscribe(()=>{this.getDataSource()})}ngOnDestroy(){this.alertObservable?.complete(),this.updateTable?.complete(),this.showFormObservable?.complete()}getDataSource(){return x(this,null,function*(){this.loading=!0;try{let e=yield this.alertParameterizationUseCase.listAlertParameterizations();this.dataSource=e,localStorage.getItem("alertDataSource")&&(localStorage.removeItem("alertDataSource"),e.length>0&&localStorage.setItem("alertDataSource",JSON.stringify(e))),this.loading=!1}catch(e){console.error("Error fetching alert parameterizations:",e),this.notification.error(e?.message||"Error al cargar las parametrizaciones de alerta"),this.loading=!1}})}editAlert(e){this.showFormObservable?.next(!0),setTimeout(()=>{this.alertObservable?.next(e)},100)}deleteAlert(e){return x(this,null,function*(){let l=this.dialog.open(Yt,{data:{title:"Eliminar parametrizaci\xF3n de alerta",message:"\xBFEst\xE1 seguro que desea eliminar esta parametrizaci\xF3n de alerta?"}});if(yield Z(l.afterClosed()))try{yield this.alertParameterizationUseCase.deleteAlertParameterization(e.uid).then(()=>x(this,null,function*(){yield this.logBook.createLogBook({action:F.DELETE,user:this.user.getUser(),date:Date.now().valueOf(),module:I.ALERT_PARAMETERIZATION,description:`Se elimin\xF3 la parametrizaci\xF3n de alerta con id ${e.uid}`})})),this.notification.success("Parametrizaci\xF3n de alerta eliminada exitosamente"),this.getDataSource()}catch(d){console.error("Error deleting alert parameterization:",d),this.notification.error(d?.message||"Error al eliminar la parametrizaci\xF3n de alerta")}})}static{this.\u0275fac=function(l){return new(l||t)}}static{this.\u0275cmp=v({type:t,selectors:[["app-alert-table"]],inputs:{alertObservable:"alertObservable",updateTable:"updateTable",showFormObservable:"showFormObservable"},standalone:!0,features:[T],decls:4,vars:2,consts:[[2,"background-color","white","border-radius","8px","padding","20px","box-shadow","0 2px 10px rgba(0,0,0,0.1)"],["class","loading-container",4,"ngIf"],[1,"table-responsive"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf"],[1,"loading-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","digits"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","value"],["matColumnDef","description"],["matColumnDef","createdBy"],["matColumnDef","createdAt"],["matColumnDef","updatedBy"],["matColumnDef","updatedAt"],["matColumnDef","actions"],["mat-header-cell","","class","actions-header",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"actions-header"],["mat-icon-button","","color","primary","title","Editar",3,"click"],["mat-icon-button","","color","warn","title","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(l,a){l&1&&(i(0,"div",0),p(1,Qt,3,0,"div",1),i(2,"div",2),p(3,_e,27,3,"table",3),n()()),l&2&&(m(),u("ngIf",a.loading),m(2),u("ngIf",!a.loading))},dependencies:[Rt,Tt,yt,It,Et,St,zt,Dt,Ft,Bt,kt,Vt,H,Ct,tt,L,U,Mt,xt],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{padding:20px;height:100%;display:flex;flex-direction:column;max-width:800px;margin:0 auto}.mat-elevation-z8[_ngcontent-%COMP%]{border-radius:8px 8px 0 0!important;box-shadow:0 2px 8px #0000001a}table[_ngcontent-%COMP%]{width:100%;overflow:hidden;flex:1}.table-row[_ngcontent-%COMP%]{height:20px!important}.mat-mdc-header-row[_ngcontent-%COMP%]{height:40px!important}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:4px 12px!important;font-size:14px;line-height:1.2}mat-paginator[_ngcontent-%COMP%]{border-radius:0 0 8px 8px!important;margin-top:0;box-shadow:0 2px 8px #0000001a}.actions-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 3px;width:90px!important;height:30px;font-size:15px;font-weight:500;border-radius:4px;line-height:1;padding:0 6px}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]{background-color:#ff9800;color:#fff}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]:hover{background-color:#f57c00}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]:hover{background-color:#d32f2f}.loading-container[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#666;font-style:italic}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]{padding:16px}table[_ngcontent-%COMP%]{font-size:14px}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:3px 6px!important}.table-row[_ngcontent-%COMP%]{height:28px!important}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:45px;height:20px;margin:0 1px;font-size:10px;padding:0 4px}}@media (min-width: 1025px){.table-container[_ngcontent-%COMP%]{padding:0;height:calc(100vh - 40px);max-width:100%;margin:0}}.mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%}.table-responsive[_ngcontent-%COMP%]{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;margin-top:16px}table[_ngcontent-%COMP%]{min-width:600px;width:100%}@media (max-width: 768px){.form-container[_ngcontent-%COMP%]{padding:12px;gap:16px}.form-card[_ngcontent-%COMP%]{padding:12px;max-width:100%}.button-group[_ngcontent-%COMP%]{flex-direction:column}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.table-responsive[_ngcontent-%COMP%]{margin-top:12px}table[_ngcontent-%COMP%]{min-width:500px;font-size:13px}}@media (min-width: 1025px){.form-container[_ngcontent-%COMP%]{padding:0;height:auto}.form-card[_ngcontent-%COMP%]{max-width:350px}}']})}}return t})();function be(t,r){if(t&1&&(i(0,"div",7)(1,"div",7),P(2,"app-alert-form",8),n()()),t&2){let e=A();m(2),u("alertObservable",e.alertObservable)("updateTable",e.updateTable)}}var wi=(()=>{class t{constructor(){this.alertObservable=new w,this.updateTable=new w,this.showFormObservable=new w,this.showForm=!1,this.isMobile=!1}ngOnInit(){this.showFormObservable.next(!1),this.showFormObservable.subscribe(e=>{this.showForm=e})}ngOnDestroy(){this.alertObservable.complete(),this.updateTable.complete(),this.showFormObservable.complete()}toggleForm(){this.showForm=!this.showForm}static{this.\u0275fac=function(l){return new(l||t)}}static{this.\u0275cmp=v({type:t,selectors:[["app-alert-parameterization-page"]],standalone:!0,features:[Q([{provide:Ht,useClass:jt},{provide:S,useClass:Lt},{provide:y,useClass:Wt},q,E,q]),T],decls:8,vars:7,consts:[[1,"alert-layout"],[1,"toolbar"],["mat-raised-button","","color","primary",3,"click"],[1,"layout"],["class","form-section",4,"ngIf"],[1,"table-section"],[3,"alertObservable","updateTable","showFormObservable"],[1,"form-section"],[3,"alertObservable","updateTable"]],template:function(l,a){l&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),M("click",function(){return a.toggleForm()}),o(3),n()(),i(4,"div",3),p(5,be,3,2,"div",4),i(6,"div",5),P(7,"app-alert-table",6),n()()()),l&2&&(m(3),g(" ",a.showForm?"Ocultar formulario":"Crear Alerta"," "),m(),z("column",a.isMobile),m(),u("ngIf",a.showForm),m(2),u("alertObservable",a.alertObservable)("updateTable",a.updateTable)("showFormObservable",a.showFormObservable))},dependencies:[Zt,Kt,L,U,$t,$],styles:[".layout[_ngcontent-%COMP%]{display:flex;gap:24px;padding:20px;box-sizing:border-box}.layout.column[_ngcontent-%COMP%]{flex-direction:column}.layout.column[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%], .layout.column[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{width:100%;flex:none}.form-section[_ngcontent-%COMP%]{flex:0 0 350px;min-width:0}.table-section[_ngcontent-%COMP%]{flex:1;min-width:0}.toolbar[_ngcontent-%COMP%]{padding:16px 20px 0}@media screen and (max-width: 1300px){.layout[_ngcontent-%COMP%]{flex-direction:column}.form-section[_ngcontent-%COMP%]{flex:none;width:100%}.table-section[_ngcontent-%COMP%]{width:100%}}"]})}}return t})();export{wi as AlertParameterizationPageComponent};
