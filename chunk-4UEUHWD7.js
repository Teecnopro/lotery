import{a as qe}from"./chunk-HF4P5JFG.js";import{a as $e,b as E}from"./chunk-PIRFJXWV.js";import{a as je}from"./chunk-3ZIDYFSV.js";import{a as We}from"./chunk-USWFCF42.js";import"./chunk-XFEE3PRU.js";import{a as D,c as F}from"./chunk-QHZRYLVR.js";import{a as S,b as Ye}from"./chunk-X67Z44SH.js";import{b as j}from"./chunk-JCPCU3BD.js";import"./chunk-DOKGUGK4.js";import{k as Ue,p as Le,q as He}from"./chunk-NN2UDVZC.js";import{A as re,Aa as Y,B as me,Ba as he,Ca as $,Da as ye,E as le,Ea as Ce,F as de,Fa as Pe,Ga as xe,H as se,Ha as Me,Ia as Oe,Ka as ve,bb as we,cb as Te,db as Se,fb as Ee,gb as De,ib as Fe,jb as Ie,la as ce,lb as ze,ma as pe,mb as Be,oa as ue,ob as Ae,pb as Ne,r as te,rb as ke,sb as Ve,va as ge,vb as Re,w as ne,wa as fe,x as ie,y as ae,ya as _e,yb as T,z as oe,za as be}from"./chunk-KWAI636N.js";import{Ab as x,Bb as b,Cb as h,Eb as A,Hb as P,Jb as O,Jc as L,Oc as X,Pc as ee,Qc as H,Rb as v,Sb as o,Ub as g,Vb as N,Wa as d,Wb as k,Xa as B,Xb as V,Yb as J,Zb as w,bc as R,dc as W,ec as Z,f as z,fa as u,gc as Q,ka as M,nb as p,pb as c,qc as U,rb as K,t as G,ta as f,ua as _,yb as n,zb as i}from"./chunk-UIILES4X.js";import{a as I,b as q,e as C}from"./chunk-DVOCWXDE.js";var Je=(()=>{class e{constructor(t){this.cdr=t,this.paymentObservable=null,this.updateTable=null,this.user=u(j),this.paymentUseCases=u(E),this.logBook=u(S),this.notification=u(T),this.textButton="Crear Pago",this.payment={},this.isEditing=!1,this.loading=!1}ngOnInit(){this.paymentObservable&&(this.subscription=this.paymentObservable.subscribe(t=>{t&&t.uid!==void 0&&(this.textButton="Editar Pago",this.isEditing=!0),this.payment=I({},t),this.cdr.detectChanges()}))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}onSubmit(t){return C(this,null,function*(){if(!t.valid){this.notification.error("Por favor, complete todos los campos requeridos");return}let l=this.user.getUser();if(!l){this.notification.error("Usuario no autenticado");return}this.loading=!0;let a=I({},t.value),r=q(I({},this.payment),{amount:a.amount,combined:a.combined,digits:a.digits});try{if(r.digits<=2&&r.combined){this.notification.error("Los d\xEDgitos deben ser mayores a 2 si la opci\xF3n combinada est\xE1 activada"),this.loading=!1;return}if((yield this.paymentUseCases.getPaymentParameterizationByValue(r.amount,r.digits,r.combined))&&!this.isEditing){this.notification.error("Ya existe una parametrizaci\xF3n de pago con este valor y d\xEDgitos"),this.loading=!1;return}this.isEditing?(r.updatedBy=l,r.updatedAt=Date.now(),yield this.paymentUseCases.updatePaymentParameterization(r.uid,r).then(s=>C(this,null,function*(){yield this.logBook.createLogBook({action:D.UPDATE,user:this.user.getUser(),date:Date.now().valueOf(),module:F.PAYMENT,description:`Se actualiz\xF3 la parametrizaci\xF3n de pago con id ${s.uid} y digitos ${r.digits} y valor de ${this.payment.amount} a ${s.amount}`})}))):(r.uid=`payment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r.createdBy=l,r.createdAt=Date.now(),yield this.paymentUseCases.createPaymentParameterization(r).then(s=>C(this,null,function*(){yield this.logBook.createLogBook({action:D.CREATE,user:this.user.getUser(),date:Date.now().valueOf(),module:F.PAYMENT,description:`Se cre\xF3 una nueva parametrizaci\xF3n de pago con d\xEDgitos ${s.digits} y valor ${s.amount}`})}))),this.notification.success(`Parametrizaci\xF3n de pago ${this.isEditing?"actualizada":"creada"} exitosamente`),this.limpiarFormulario(t),this.loading=!1,this.updateTable?.next(!0)}catch(y){console.error("Error saving payment parameterization:",y),this.notification.error(y?.message||"Error al guardar la parametrizaci\xF3n de pago")}finally{this.loading=!1}})}limpiarFormulario(t){t.resetForm(),this.textButton="Crear Pago",this.isEditing=!1,this.payment={},this.cdr.detectChanges()}static{this.\u0275fac=function(l){return new(l||e)(B(U))}}static{this.\u0275cmp=M({type:e,selectors:[["app-payment-form"]],inputs:{paymentObservable:"paymentObservable",updateTable:"updateTable"},standalone:!0,features:[w],decls:29,vars:8,consts:[["paymentForm","ngForm"],[1,"form-container"],[1,"form-card"],[1,"payment-form",3,"ngSubmit"],["appearance","outline",1,"full-width"],["matInput","","type","number","name","digits","required","","min","1","placeholder","Ingrese los digitos",3,"ngModelChange","ngModel"],["matInput","","type","number","name","amount","required","","min","0","placeholder","Ingrese el multiplicador",3,"ngModelChange","ngModel"],["name","combined","required","",3,"ngModelChange","ngModel"],[3,"value"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-outlined-button","","type","button",3,"click","disabled"]],template:function(l,a){if(l&1){let r=A();n(0,"div",1)(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title"),o(4,"Configuraci\xF3n de Pago"),i()(),n(5,"mat-card-content")(6,"form",3,0),P("ngSubmit",function(){f(r);let s=v(7);return _(a.onSubmit(s))}),n(8,"mat-form-field",4)(9,"mat-label"),o(10,"Digitos"),i(),n(11,"input",5),V("ngModelChange",function(s){return f(r),k(a.payment.digits,s)||(a.payment.digits=s),_(s)}),i()(),n(12,"mat-form-field",4)(13,"mat-label"),o(14,"Multiplicador de pago"),i(),n(15,"input",6),V("ngModelChange",function(s){return f(r),k(a.payment.amount,s)||(a.payment.amount=s),_(s)}),i()(),n(16,"mat-form-field",4)(17,"mat-label"),o(18,"Combinado"),i(),n(19,"mat-select",7),V("ngModelChange",function(s){return f(r),k(a.payment.combined,s)||(a.payment.combined=s),_(s)}),n(20,"mat-option",8),o(21,"S\xED"),i(),n(22,"mat-option",8),o(23,"No"),i()()(),n(24,"div",9)(25,"button",10),o(26),i(),n(27,"button",11),P("click",function(){f(r);let s=v(7);return _(a.limpiarFormulario(s))}),o(28," Limpiar "),i()()()()()()}if(l&2){let r=v(7);d(11),N("ngModel",a.payment.digits),d(4),N("ngModel",a.payment.amount),d(4),N("ngModel",a.payment.combined),d(),c("value",!0),d(2),c("value",!1),d(3),c("disabled",!r.valid||a.loading),d(),g(" ",a.loading?"Guardando...":a.textButton," "),d(),c("disabled",a.loading)}},dependencies:[se,re,te,me,ne,ie,de,le,oe,ae,fe,ge,ue,be,_e,Ve,ke,ce,pe,$,Y,ve,Pe,Me,Oe,xe],styles:[".form-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;padding:15px;height:fit-content}.form-card[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:16px;border-radius:8px;box-shadow:0 2px 8px #0000001a}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:12px;text-align:center}.form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;color:#333;margin:0}.payment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.payment-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.payment-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{border-radius:4px}.button-group[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:center;margin-top:12px}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:90px;height:36px;border-radius:4px;font-weight:500;font-size:14px}.button-group[_ngcontent-%COMP%]   button[color=primary][_ngcontent-%COMP%]:disabled{background:#ccc;color:#999}@media (max-width: 768px){.form-container[_ngcontent-%COMP%], .form-card[_ngcontent-%COMP%]{padding:12px}.button-group[_ngcontent-%COMP%]{flex-direction:column}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}@media (min-width: 1025px){.form-container[_ngcontent-%COMP%]{padding:0;height:auto}.form-card[_ngcontent-%COMP%]{max-width:350px}}"]})}}return e})();function Xe(e,m){e&1&&(n(0,"div",3)(1,"p"),o(2,"Cargando parametrizaciones de pago..."),i()())}function et(e,m){e&1&&(n(0,"th",20),o(1," Digitos "),i())}function tt(e,m){if(e&1&&(n(0,"td",21),o(1),i()),e&2){let t=m.$implicit;d(),g(" ",t.digits," ")}}function nt(e,m){e&1&&(n(0,"th",20),o(1," Multiplicador de pago "),i())}function it(e,m){if(e&1&&(n(0,"td",21),o(1),R(2,"currency"),i()),e&2){let t=m.$implicit;d(),g(" ",Z(2,1,t.amount,"COP","symbol")," ")}}function at(e,m){e&1&&(n(0,"th",22),o(1," Combinado? "),i())}function ot(e,m){e&1&&(n(0,"span",25)(1,"mat-icon"),o(2,"sync"),i()())}function rt(e,m){e&1&&(n(0,"span",26)(1,"mat-icon"),o(2,"sync_disabled"),i()())}function mt(e,m){if(e&1&&(n(0,"td",23),p(1,ot,3,0,"span",24)(2,rt,3,0,"ng-template",null,0,Q),i()),e&2){let t=m.$implicit,l=v(3);d(),c("ngIf",t.combined)("ngIfElse",l)}}function lt(e,m){e&1&&(n(0,"th",20),o(1," Creado por "),i())}function dt(e,m){if(e&1&&(n(0,"td",21),o(1),i()),e&2){let t=m.$implicit;d(),g(" ",(t.createdBy==null?null:t.createdBy.name)||"N/A"," ")}}function st(e,m){e&1&&(n(0,"th",20),o(1," Fecha de creaci\xF3n "),i())}function ct(e,m){if(e&1&&(n(0,"td",21),o(1),R(2,"date"),i()),e&2){let t=m.$implicit;d(),g(" ",t.createdAt?W(2,1,t.createdAt,"dd-MM-YYYY hh:mm:ss"):"N/A"," ")}}function pt(e,m){e&1&&(n(0,"th",20),o(1," Actualizado por "),i())}function ut(e,m){if(e&1&&(n(0,"td",21),o(1),i()),e&2){let t=m.$implicit;d(),g(" ",(t.updatedBy==null?null:t.updatedBy.name)||"N/A"," ")}}function gt(e,m){e&1&&(n(0,"th",20),o(1," \xDAltima actualizaci\xF3n "),i())}function ft(e,m){if(e&1&&(n(0,"td",21),o(1),R(2,"date"),i()),e&2){let t=m.$implicit;d(),g(" ",t.updatedAt?W(2,1,t.updatedAt,"dd-MM-YYYY hh:mm:ss"):"N/A"," ")}}function _t(e,m){e&1&&(n(0,"th",27),o(1," Acciones "),i())}function bt(e,m){if(e&1){let t=A();n(0,"td",21)(1,"button",28),P("click",function(){let a=f(t).$implicit,r=O(2);return _(r.editPayment(a))}),n(2,"mat-icon"),o(3,"edit"),i()(),n(4,"button",29),P("click",function(){let a=f(t).$implicit,r=O(2);return _(r.deletePayment(a))}),n(5,"mat-icon"),o(6,"delete"),i()()()}}function ht(e,m){e&1&&x(0,"tr",30)}function yt(e,m){e&1&&x(0,"tr",31)}function Ct(e,m){if(e&1&&(n(0,"table",4),b(1,5),p(2,et,2,0,"th",6)(3,tt,2,1,"td",7),h(),b(4,8),p(5,nt,2,0,"th",6)(6,it,3,5,"td",7),h(),b(7,9),p(8,at,2,0,"th",10)(9,mt,4,2,"td",11),h(),b(10,12),p(11,lt,2,0,"th",6)(12,dt,2,1,"td",7),h(),b(13,13),p(14,st,2,0,"th",6)(15,ct,3,4,"td",7),h(),b(16,14),p(17,pt,2,0,"th",6)(18,ut,2,1,"td",7),h(),b(19,15),p(20,gt,2,0,"th",6)(21,ft,3,4,"td",7),h(),b(22,16),p(23,_t,2,0,"th",17)(24,bt,7,0,"td",7),h(),p(25,ht,1,0,"tr",18)(26,yt,1,0,"tr",19),i()),e&2){let t=O();c("dataSource",t.dataSource),d(25),c("matHeaderRowDef",t.displayedColumns),d(),c("matRowDefColumns",t.displayedColumns)}}var Ze=(()=>{class e{constructor(t){this.cdr=t,this.paymentObservable=null,this.updateTable=null,this.showFormObservable=null,this.paymentParameterizationUseCase=u(E),this.user=u(j),this.logBook=u(S),this.notification=u(T),this.dialog=u(Ue),this.loading=!1,this.dataSource=[],this.displayedColumns=["digits","amount","combined","createdBy","createdAt","updatedBy","updatedAt","actions"]}ngOnInit(){this.getDataSource(),this.updateTable&&(this.updateSubscription=this.updateTable.subscribe(t=>{this.getDataSource()}))}ngOnDestroy(){this.updateSubscription&&this.updateSubscription.unsubscribe()}getDataSource(){return C(this,null,function*(){this.loading=!0;try{let t=yield this.paymentParameterizationUseCase.listPaymentParameterizations();localStorage.getItem("paymentDataSource")&&(localStorage.removeItem("paymentDataSource"),t.length>0&&localStorage.setItem("paymentDataSource",JSON.stringify(t.map(l=>(delete l.uid,l))))),this.dataSource=t}catch(t){console.error("Error fetching payment parameterizations:",t),this.notification.error(t?.message||"Error al cargar las parametrizaciones de pago")}finally{this.loading=!1}})}editPayment(t){document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.showFormObservable?.next(!0),setTimeout(()=>{this.paymentObservable?.next(t)},100)}deletePayment(t){return C(this,null,function*(){document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur();let l=this.dialog.open(We,{data:{title:"Eliminar parametrizaci\xF3n de pago",message:"\xBFEst\xE1 seguro que desea eliminar esta parametrizaci\xF3n de pago?"}});if(yield G(l.afterClosed()))try{yield this.paymentParameterizationUseCase.deletePaymentParameterization(t.uid).then(()=>C(this,null,function*(){yield this.logBook.createLogBook({action:D.DELETE,user:this.user.getUser(),date:Date.now().valueOf(),module:F.PAYMENT,description:`Se elimin\xF3 la parametrizaci\xF3n de alerta con id ${t.uid}`})})),this.notification.success("Parametrizaci\xF3n de pago eliminada exitosamente"),yield this.getDataSource()}catch(r){console.error("Error deleting payment parameterization:",r),this.notification.error(r?.message||"Error al eliminar la parametrizaci\xF3n de pago")}})}static{this.\u0275fac=function(l){return new(l||e)(B(U))}}static{this.\u0275cmp=M({type:e,selectors:[["app-payment-table"]],inputs:{paymentObservable:"paymentObservable",updateTable:"updateTable",showFormObservable:"showFormObservable"},standalone:!0,features:[w],decls:3,vars:2,consts:[["noCombinado",""],["class","loading-container",4,"ngIf"],["mat-table","","class","mat-elevation-z8",3,"dataSource",4,"ngIf"],[1,"loading-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","digits"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["matColumnDef","combined"],["mat-header-cell","","style","text-align: right;",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right;",4,"matCellDef"],["matColumnDef","createdBy"],["matColumnDef","createdAt"],["matColumnDef","updatedBy"],["matColumnDef","updatedAt"],["matColumnDef","actions"],["mat-header-cell","","class","actions-header",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["matTooltip","Combinado","style","display: flex; align-items: center; gap: 4px; justify-content: flex-end;","class","combinado",4,"ngIf","ngIfElse"],["matTooltip","Combinado",1,"combinado",2,"display","flex","align-items","center","gap","4px","justify-content","flex-end"],["matTooltip","No Combinado",1,"no-combinado",2,"display","flex","align-items","center","gap","4px","justify-content","flex-end"],["mat-header-cell","",1,"actions-header"],["mat-icon-button","","color","primary","title","Editar",3,"click"],["mat-icon-button","","color","warn","title","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(l,a){l&1&&(n(0,"div"),p(1,Xe,3,0,"div",1)(2,Ct,27,3,"table",2),i()),l&2&&(d(),c("ngIf",a.loading),d(),c("ngIf",!a.loading))},dependencies:[Ne,we,Se,Ie,Ee,Te,ze,De,Fe,Be,Ae,Re,$,he,X,H,L,ee,Ce,ye],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{padding:20px;height:100%;display:flex;flex-direction:column;max-width:800px;margin:0 auto}.mat-elevation-z8[_ngcontent-%COMP%]{border-radius:8px 8px 0 0!important;box-shadow:0 2px 8px #0000001a}table[_ngcontent-%COMP%]{width:100%;overflow:hidden;flex:1}.table-row[_ngcontent-%COMP%]{height:20px!important}.mat-mdc-header-row[_ngcontent-%COMP%]{height:40px!important}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:4px 12px!important;font-size:14px;line-height:1.2}mat-paginator[_ngcontent-%COMP%]{border-radius:0 0 8px 8px!important;margin-top:0;box-shadow:0 2px 8px #0000001a}.actions-header[_ngcontent-%COMP%]{text-align:center!important}.actions-cell[_ngcontent-%COMP%]{text-align:center}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 3px;width:90px!important;height:30px;font-size:15px;font-weight:500;border-radius:4px;line-height:1;padding:0 6px}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]{background-color:#ff9800;color:#fff}.actions-cell[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]:hover{background-color:#f57c00}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.actions-cell[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]:hover{background-color:#d32f2f}.loading-container[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#666;font-style:italic}@media (max-width: 768px){.table-container[_ngcontent-%COMP%]{padding:16px}table[_ngcontent-%COMP%]{font-size:14px}.mat-mdc-cell[_ngcontent-%COMP%], .mat-mdc-header-cell[_ngcontent-%COMP%]{padding:3px 6px!important}.table-row[_ngcontent-%COMP%]{height:28px!important}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:45px;height:20px;margin:0 1px;font-size:10px;padding:0 4px}}@media (min-width: 1025px){.table-container[_ngcontent-%COMP%]{padding:0;height:calc(100vh - 40px);max-width:100%;margin:0}}.combinado[_ngcontent-%COMP%]{font-weight:600;color:#03fc0c}.no-combinado[_ngcontent-%COMP%]{font-weight:600;color:#f70505}']})}}return e})();function Pt(e,m){if(e&1&&(n(0,"div",8)(1,"div",8),x(2,"app-payment-form",9),i()()),e&2){let t=O();d(2),c("paymentObservable",t.paymentObservable)("updateTable",t.updateTable)}}var Tn=(()=>{class e{constructor(){this.paymentObservable=new z,this.updateTable=new z,this.showFormObservable=new z,this.showForm=!1,this.isMobile=!1}toggleForm(){this.showForm=!this.showForm}ngOnInit(){this.showFormObservable.next(!1),this.showFormObservable.subscribe(t=>{this.showForm=t})}ngOnDestroy(){this.paymentObservable.complete(),this.updateTable.complete(),this.showFormObservable.complete()}static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275cmp=M({type:e,selectors:[["app-payment-parameterization-page"]],standalone:!0,features:[J([{provide:$e,useClass:qe},{provide:T,useClass:Le},{provide:S,useClass:je},Ye,E]),w],decls:11,vars:7,consts:[[1,"alert-layout"],[1,"toolbar"],["mat-raised-button","","color","primary",3,"click"],[1,"layout"],["class","form-section",4,"ngIf"],[1,"table-section"],[3,"paymentObservable","updateTable","showFormObservable"],[1,"payment-layout"],[1,"form-section"],[3,"paymentObservable","updateTable"]],template:function(l,a){l&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),P("click",function(){return a.toggleForm()}),o(3),i()(),n(4,"div",3),p(5,Pt,3,2,"div",4),n(6,"div",5),x(7,"app-payment-table",6),i()()(),n(8,"div",7),x(9,"div",8)(10,"div",5),i()),l&2&&(d(3),g(" ",a.showForm?"Ocultar formulario":"Crear Pago"," "),d(),K("column",a.isMobile),d(),c("ngIf",a.showForm),d(2),c("paymentObservable",a.paymentObservable)("updateTable",a.updateTable)("showFormObservable",a.showFormObservable))},dependencies:[Je,Ze,H,L,He,Y],styles:[".layout[_ngcontent-%COMP%]{display:flex;gap:24px;padding:20px;box-sizing:border-box}.layout.column[_ngcontent-%COMP%]{flex-direction:column}.layout.column[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%], .layout.column[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]{width:100%;flex:none}.form-section[_ngcontent-%COMP%]{flex:0 0 350px;min-width:0}.table-section[_ngcontent-%COMP%]{flex:1;min-width:0}.toolbar[_ngcontent-%COMP%]{padding:16px 20px 0}"]})}}return e})();export{Tn as PaymentParameterizationPageComponent};
